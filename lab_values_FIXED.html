<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Values Clinical Reference</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 20px; color: #e0e0e0; }
        .header { text-align: center; padding: 30px 20px; background: rgba(255,255,255,0.05); border-radius: 16px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .header h1 { font-size: 28px; color: #fff; margin-bottom: 8px; }
        .header p { color: #aaa; font-size: 14px; }
        .controls { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .search-box { width: 100%; padding: 14px 20px; border: 2px solid rgba(255,255,255,0.2); border-radius: 12px; font-size: 16px; background: rgba(0,0,0,0.3); color: #fff; margin-bottom: 15px; }
        .search-box::placeholder { color: #888; }
        .filter-section { margin-bottom: 15px; }
        .filter-label { font-size: 12px; color: #888; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .filter-buttons { display: flex; flex-wrap: wrap; gap: 8px; }
        .filter-btn { padding: 8px 16px; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; background: transparent; color: #ccc; cursor: pointer; font-size: 13px; transition: all 0.2s; -webkit-tap-highlight-color: rgba(74,144,217,0.3); touch-action: manipulation; }
        .filter-btn:hover { background: rgba(255,255,255,0.1); }
        .filter-btn.active { background: #4a90d9; border-color: #4a90d9; color: #fff; }
        .toc-section { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); scroll-margin-top: 50px; }
        .toc-toggle { width: 100%; padding: 15px; background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.4); border-radius: 12px; color: #81c784; font-size: 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3); touch-action: manipulation; scroll-margin-top: 50px; }
        .toc-content { display: none; margin-top: 15px; }
        .toc-content.show { display: block; }
        .toc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .toc-category h4 { color: #4a90d9; margin-bottom: 10px; font-size: 14px; }
        .toc-list { list-style: none; }
        .toc-list li { margin-bottom: 0; }
        .toc-link { color: #aaa; text-decoration: none; font-size: 13px; display: block; padding: 8px 5px; -webkit-tap-highlight-color: rgba(74,144,217,0.3); touch-action: manipulation; }
        .toc-link:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .results-info { color: #888; font-size: 14px; margin-bottom: 15px; padding-left: 5px; }
        .lab-grid { display: grid; gap: 20px; }
        .lab-card { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); scroll-margin-top: 70px; }
        .lab-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .lab-title { font-size: 20px; font-weight: 600; color: #fff; }
        .lab-subtitle { font-size: 14px; color: #888; margin-top: 4px; }
        .badge-container { display: flex; gap: 8px; flex-wrap: wrap; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .badge-high { background: rgba(244, 67, 54, 0.2); color: #ef5350; border: 1px solid rgba(244, 67, 54, 0.3); }
        .badge-low { background: rgba(33, 150, 243, 0.2); color: #42a5f5; border: 1px solid rgba(33, 150, 243, 0.3); }
        .badge-critical { background: rgba(156, 39, 176, 0.2); color: #ba68c8; border: 1px solid rgba(156, 39, 176, 0.3); }
        .badge-severe { background: rgba(255, 152, 0, 0.2); color: #ffb74d; border: 1px solid rgba(255, 152, 0, 0.3); }
        .badge-moderate { background: rgba(255, 193, 7, 0.2); color: #ffd54f; border: 1px solid rgba(255, 193, 7, 0.3); }
        .section { margin-bottom: 20px; }
        .section-title { font-size: 14px; color: #4a90d9; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .threshold-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .threshold-item { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; text-align: center; }
        .threshold-label { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        .threshold-value { font-size: 14px; color: #fff; font-weight: 500; }
        .list-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; line-height: 1.5; }
        .list-item:last-child { border-bottom: none; }
        .imcrg-link { color: #4fc3f7; text-decoration: none; border-bottom: 1px dotted #4fc3f7; transition: all 0.2s; cursor: pointer; -webkit-tap-highlight-color: rgba(79, 195, 247, 0.3); }
        .imcrg-link:hover { color: #81d4fa; background: rgba(79, 195, 247, 0.1); border-bottom-style: solid; }
        .back-to-top { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: #4a90d9; border: none; border-radius: 50%; color: #fff; font-size: 20px; cursor: pointer; display: none; z-index: 100; box-shadow: 0 4px 15px rgba(74,144,217,0.4); }
        .back-to-top.show { display: flex; align-items: center; justify-content: center; }
        
        /* Slide-in Panel Styles */
        .panel-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .panel-overlay.active { opacity: 1; visibility: visible; }
        .slide-panel { position: fixed; top: 0; right: -80%; width: 80%; height: 100%; background: #1a1a2e; z-index: 1001; transition: right 0.3s ease-out; box-shadow: -5px 0 30px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .slide-panel.active { right: 0; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; flex-shrink: 0; }
        .panel-title { font-size: 16px; font-weight: 600; flex: 1; }
        .panel-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-left: 10px; transition: background 0.2s; }
        .panel-btn:hover { background: rgba(255,255,255,0.3); }
        .panel-content { flex: 1; overflow: hidden; }
        .panel-content iframe { width: 100%; height: 100%; border: none; }
        
        @media (max-width: 768px) { 
            body { padding: 10px; } 
            .header h1 { font-size: 22px; } 
            .lab-card { padding: 20px; } 
            .threshold-grid { grid-template-columns: repeat(2, 1fr); }
            .slide-panel { width: 95%; right: -95%; }
        }
    </style>
</head>
<body>
    <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); text-align: center; position: sticky; top: 0; z-index: 100;">
        <a href="im_guide.html" style="color: white; text-decoration: none; font-weight: 600; font-size: 12px; display: block; padding: 8px 15px; -webkit-tap-highlight-color: rgba(255,255,255,0.3);">ðŸ“š Open Full IM Clinical Reference Guide â†’</a>
    </div>
    <div class="header">
        <h1>ðŸ”¬ Laboratory Values Clinical Reference</h1>
        <p>100 Laboratory Tests | Tap conditions to view IMCRG details</p>
    </div>

    <div class="controls">
        <input type="text" class="search-box" id="searchBox" placeholder="Search lab tests, conditions, or keywords...">
        <div class="filter-section">
            <div class="filter-label">Category</div>
            <div class="filter-buttons" id="categoryFilters">
                <button class="filter-btn active" data-category="all">All</button>
                <button class="filter-btn" data-category="electrolytes">Electrolytes</button>
                <button class="filter-btn" data-category="cbc">CBC</button>
                <button class="filter-btn" data-category="renal">Renal</button>
                <button class="filter-btn" data-category="hepatic">Hepatic</button>
                <button class="filter-btn" data-category="cardiac">Cardiac</button>
                <button class="filter-btn" data-category="endocrine">Endocrine</button>
                <button class="filter-btn" data-category="coagulation">Coagulation</button>
                <button class="filter-btn" data-category="inflammatory">Inflammatory</button>
                <button class="filter-btn" data-category="iron">Iron Studies</button>
                <button class="filter-btn" data-category="lipids">Lipids</button>
                <button class="filter-btn" data-category="abg">ABG</button>
                <button class="filter-btn" data-category="bodyfluid">Body Fluids</button>
                <button class="filter-btn" data-category="infectious">Infectious</button>
                <button class="filter-btn" data-category="tumor">Tumor Markers</button>
                <button class="filter-btn" data-category="drugs">Drug Levels</button>
                <button class="filter-btn" data-category="misc">Misc</button>
            </div>
        </div>
        <div class="filter-section">
            <div class="filter-label">Direction</div>
            <div class="filter-buttons" id="directionFilters">
                <button class="filter-btn active" data-direction="all">All</button>
                <button class="filter-btn" data-direction="high">â†‘ High</button>
                <button class="filter-btn" data-direction="low">â†“ Low</button>
            </div>
        </div>
    </div>

    <div class="toc-section">
        <button class="toc-toggle" id="tocToggle"><span>ðŸ“‹ Table of Contents (100 Laboratory Tests)</span><span id="tocArrow">â–¼</span></button>
        <div class="toc-content" id="tocContent"><div class="toc-grid" id="tocGrid"></div></div>
    </div>

    <div class="results-info" id="resultsInfo">Showing all 100 laboratory values</div>
    <div class="lab-grid" id="labGrid"></div>
    <button class="back-to-top" id="backToTop">â†‘</button>

    <!-- Slide-in Panel -->
    <div class="panel-overlay" id="panelOverlay"></div>
    <div class="slide-panel" id="slidePanel">
        <div class="panel-header">
            <span class="panel-title" id="panelTitle">IMCRG Reference</span>
            <button class="panel-btn" id="panelFullscreen" title="Open Full Screen">â›¶</button>
            <button class="panel-btn" id="panelClose" title="Close">âœ•</button>
        </div>
        <div class="panel-content">
            <iframe id="panelIframe" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        // Comprehensive IMCRG condition mapping with display names
        const imcrgMap = {
            "acs": "acs", "acute coronary syndrome": "acs", "mi": "acs", "myocardial infarction": "acs", "nstemi": "acs", "stemi": "acs",
            "heart failure": "heart-failure", "chf": "heart-failure", "hfref": "heart-failure", "hfpef": "heart-failure", "decompensated heart failure": "heart-failure",
            "atrial fibrillation": "afib", "afib": "afib", "a-fib": "afib", "af": "afib",
            "hypertensive emergency": "htn-emergency", "hypertensive crisis": "htn-emergency", "malignant hypertension": "htn-emergency",
            "dvt": "dvt", "deep vein thrombosis": "dvt", "deep venous thrombosis": "dvt",
            "syncope": "syncope",
            "pericarditis": "pericarditis", "pericardial effusion": "pericarditis", "cardiac tamponade": "pericarditis", "tamponade": "pericarditis",
            "endocarditis": "endocarditis", "infective endocarditis": "endocarditis",
            "myocarditis": "myocarditis",
            "cardiogenic shock": "cardiogenic-shock",
            "bradycardia": "bradycardia", "heart block": "bradycardia", "av block": "bradycardia",
            "vt": "vt-vf", "vf": "vt-vf", "ventricular tachycardia": "vt-vf", "ventricular fibrillation": "vt-vf",
            "limb ischemia": "limb-ischemia", "acute limb ischemia": "limb-ischemia", "ali": "limb-ischemia",
            "pneumonia": "cap", "cap": "cap", "community-acquired pneumonia": "cap",
            "copd": "copd", "copd exacerbation": "copd",
            "asthma": "asthma", "asthma exacerbation": "asthma", "status asthmaticus": "asthma",
            "pe": "pe", "pulmonary embolism": "pe", "pulmonary embolus": "pe",
            "pleural effusion": "pleural-effusion",
            "pneumothorax": "pneumothorax", "tension pneumothorax": "pneumothorax",
            "ild": "ild", "interstitial lung disease": "ild", "pulmonary fibrosis": "ild",
            "hemoptysis": "hemoptysis",
            "hypercapnic respiratory failure": "hypercapnic-failure", "hypercapnia": "hypercapnic-failure", "co2 retention": "hypercapnic-failure",
            "influenza": "influenza", "flu": "influenza", "viral pneumonia": "influenza",
            "covid": "covid", "covid-19": "covid", "sars-cov-2": "covid",
            "sepsis": "sepsis", "septic shock": "sepsis", "severe sepsis": "sepsis",
            "cellulitis": "cellulitis",
            "uti": "uti", "pyelonephritis": "uti", "urinary tract infection": "uti",
            "c. diff": "cdiff", "c diff": "cdiff", "cdiff": "cdiff", "c. difficile": "cdiff", "clostridioides difficile": "cdiff", "clostridium difficile": "cdiff",
            "meningitis": "meningitis", "bacterial meningitis": "meningitis",
            "neutropenic fever": "neutropenic-fever", "febrile neutropenia": "neutropenic-fever",
            "ssti": "ssti", "necrotizing fasciitis": "ssti", "nec fasc": "ssti",
            "tuberculosis": "tb", "tb": "tb", "active tb": "tb",
            "hiv": "hiv-aids", "aids": "hiv-aids", "hiv/aids": "hiv-aids",
            "opportunistic infection": "opportunistic", "oi": "opportunistic", "pcp": "opportunistic", "pneumocystis": "opportunistic",
            "aki": "aki", "acute kidney injury": "aki", "acute renal failure": "aki", "arf": "aki",
            "hyperkalemia": "hyperkalemia", "elevated potassium": "hyperkalemia",
            "hyponatremia": "hyponatremia", "low sodium": "hyponatremia",
            "siadh": "siadh", "syndrome of inappropriate adh": "siadh",
            "ckd": "ckd-complications", "chronic kidney disease": "ckd-complications", "esrd": "ckd-complications", "end-stage renal disease": "ckd-complications",
            "uremia": "uremia", "uremic": "uremia",
            "hypercalcemia": "hypercalcemia",
            "hypocalcemia": "hypocalcemia",
            "hypomagnesemia": "hypomag", "low magnesium": "hypomag",
            "hypermagnesemia": "magnesium-disorders",
            "hypophosphatemia": "phosphate", "hyperphosphatemia": "phosphate",
            "metabolic alkalosis": "metabolic-alkalosis",
            "cirrhosis": "cirrhosis", "liver cirrhosis": "cirrhosis", "hepatic cirrhosis": "cirrhosis",
            "hepatic encephalopathy": "he", "he": "he", "encephalopathy": "he",
            "sbp": "sbp", "spontaneous bacterial peritonitis": "sbp",
            "variceal bleeding": "cirrhosis-complications", "variceal hemorrhage": "cirrhosis-complications", "hepatorenal": "cirrhosis-complications", "hrs": "cirrhosis-complications",
            "aclf": "aclf", "acute-on-chronic liver failure": "aclf",
            "ugib": "ugib", "upper gi bleed": "ugib", "gi bleed": "ugib", "gastrointestinal bleeding": "ugib",
            "pancreatitis": "pancreatitis", "acute pancreatitis": "pancreatitis",
            "bowel obstruction": "bowel-obstruction", "sbo": "bowel-obstruction", "small bowel obstruction": "bowel-obstruction",
            "diverticulitis": "diverticulitis",
            "ibd": "ibd", "inflammatory bowel disease": "ibd", "crohn": "ibd", "ulcerative colitis": "ibd",
            "acute diarrhea": "acute-diarrhea", "diarrhea": "acute-diarrhea",
            "mesenteric ischemia": "mesenteric-ischemia", "ischemic bowel": "mesenteric-ischemia",
            "dka": "dka", "diabetic ketoacidosis": "dka",
            "hhs": "hhs", "hyperosmolar hyperglycemic": "hhs", "hyperosmolar state": "hhs",
            "hypothyroidism": "hypothyroid", "hypothyroid": "hypothyroid", "myxedema": "hypothyroid", "myxedema coma": "hypothyroid",
            "hyperthyroidism": "hyperthyroid", "hyperthyroid": "hyperthyroid", "thyroid storm": "hyperthyroid", "thyrotoxicosis": "hyperthyroid", "graves": "hyperthyroid",
            "adrenal insufficiency": "adrenal", "adrenal crisis": "adrenal", "addison": "adrenal", "primary adrenal insufficiency": "adrenal", "secondary adrenal insufficiency": "adrenal",
            "diabetes insipidus": "diabetes-insipidus", "di": "diabetes-insipidus",
            "pheochromocytoma": "pheo", "pheo": "pheo",
            "anemia": "anemia",
            "hemolytic anemia": "hemolytic-anemia", "hemolysis": "hemolytic-anemia", "autoimmune hemolytic": "hemolytic-anemia", "aiha": "hemolytic-anemia",
            "thrombocytopenia": "thrombocytopenia", "low platelets": "thrombocytopenia", "itp": "thrombocytopenia", "ttp": "thrombocytopenia", "hus": "thrombocytopenia", "hit": "thrombocytopenia",
            "dic": "dic", "disseminated intravascular coagulation": "dic",
            "sickle cell": "sickle-cell", "sickle cell crisis": "sickle-cell", "vaso-occlusive crisis": "sickle-cell",
            "tumor lysis": "tls", "tls": "tls", "tumor lysis syndrome": "tls",
            "transfusion reaction": "transfusion", "transfusion": "transfusion",
            "anticoagulation reversal": "anticoag-reversal", "bleeding reversal": "anticoag-reversal",
            "oncologic emergency": "onc-emergencies", "svc syndrome": "onc-emergencies", "spinal cord compression": "cord-compression",
            "stroke": "stroke", "cva": "stroke", "ischemic stroke": "stroke", "acute stroke": "stroke",
            "tia": "tia", "transient ischemic attack": "tia",
            "seizure": "seizure", "status epilepticus": "seizure", "convulsion": "seizure",
            "delirium": "delirium", "acute confusion": "delirium", "altered mental status": "delirium", "ams": "delirium",
            "increased icp": "increased-icp", "elevated icp": "increased-icp", "intracranial pressure": "increased-icp", "cerebral edema": "increased-icp",
            "gbs": "gbs", "guillain-barre": "gbs", "guillain-barrÃ©": "gbs",
            "myasthenia gravis": "myasthenia", "myasthenic crisis": "myasthenia",
            "cord compression": "cord-compression", "spinal cord compression": "cord-compression",
            "gout": "gout", "pseudogout": "gout", "gouty arthritis": "gout",
            "gca": "gca", "giant cell arteritis": "gca", "temporal arteritis": "gca",
            "sle": "sle", "lupus": "sle", "systemic lupus": "sle",
            "anaphylaxis": "anaphylaxis", "anaphylactic shock": "anaphylaxis",
            "rhabdomyolysis": "rhabdo", "rhabdo": "rhabdo",
            "alcohol withdrawal": "etoh-withdrawal", "etoh withdrawal": "etoh-withdrawal", "delirium tremens": "etoh-withdrawal", "dts": "etoh-withdrawal",
            "opioid overdose": "opioid", "opioid withdrawal": "opioid", "narcan": "opioid",
            "overdose": "overdose", "drug overdose": "overdose", "toxidrome": "overdose"
        ,
            "aaa rupture": "ruptured-aaa",
            "abdominal abscess": "intraabdominal-abscess",
            "acute appendicitis": "appendicitis",
            "acute cholangitis": "cholangitis",
            "acute cholecystitis": "cholecystitis",
            "acute glomerulonephritis": "glomerulonephritis",
            "acute leukemia": "acute-leukemia-lymphoma",
            "all": "acute-leukemia-lymphoma",
            "aml": "acute-leukemia-lymphoma",
            "aplastic anemia": "bone-marrow-failure",
            "appendicitis": "appendicitis",
            "b12 deficiency": "b12-folate-deficiency",
            "bone marrow failure": "bone-marrow-failure",
            "bowel perforation": "perforation",
            "burns": "burns-third-spacing",
            "cerebral salt wasting": "cerebral-salt-wasting",
            "chest wall pain": "musculoskeletal-chest-pain",
            "cholangitis": "cholangitis",
            "cholecystitis": "cholecystitis",
            "concussion": "traumatic-brain-injury",
            "costochondritis": "musculoskeletal-chest-pain",
            "csw": "cerebral-salt-wasting",
            "diffuse esophageal spasm": "esophageal-spasm",
            "drug-induced thrombocytopenia": "drug-induced-thrombocytopenia",
            "encephalitis": "encephalitis",
            "esophageal spasm": "esophageal-spasm",
            "falciparum malaria": "malaria",
            "familial hemiplegic migraine": "hemiplegic-migraine",
            "folate deficiency": "b12-folate-deficiency",
            "gastric erosions": "gastritis-erosions",
            "gastritis": "gastritis-erosions",
            "gi perforation": "perforation",
            "glomerulonephritis": "glomerulonephritis",
            "head trauma": "traumatic-brain-injury",
            "hemiplegic migraine": "hemiplegic-migraine",
            "hemorrhoids": "hemorrhoids",
            "ich": "ich",
            "intra-abdominal abscess": "intraabdominal-abscess",
            "intraabdominal abscess": "intraabdominal-abscess",
            "intracerebral hemorrhage": "ich",
            "leukemia": "acute-leukemia-lymphoma",
            "lymphoma": "acute-leukemia-lymphoma",
            "malaria": "malaria",
            "mallory weiss": "mallory-weiss",
            "mallory-weiss": "mallory-weiss",
            "mallory-weiss tear": "mallory-weiss",
            "mds": "bone-marrow-failure",
            "musculoskeletal chest pain": "musculoskeletal-chest-pain",
            "myelodysplastic syndrome": "bone-marrow-failure",
            "neurogenic shock": "neurogenic-shock",
            "perforation": "perforation",
            "pernicious anemia": "b12-folate-deficiency",
            "plasmodium falciparum": "malaria",
            "postictal paralysis": "todds-paralysis",
            "primary polydipsia": "psychogenic-polydipsia",
            "psychogenic polydipsia": "psychogenic-polydipsia",
            "rapidly progressive glomerulonephritis": "glomerulonephritis",
            "renal tubular acidosis": "rta",
            "rpgn": "glomerulonephritis",
            "rta": "rta",
            "ruptured aaa": "ruptured-aaa",
            "ruptured abdominal aortic aneurysm": "ruptured-aaa",
            "sah": "sah",
            "spinal shock": "neurogenic-shock",
            "subarachnoid hemorrhage": "sah",
            "tbi": "traumatic-brain-injury",
            "thermal burns": "burns-third-spacing",
            "third spacing": "burns-third-spacing",
            "third-spacing": "burns-third-spacing",
            "tietze syndrome": "musculoskeletal-chest-pain",
            "todd paralysis": "todds-paralysis",
            "todd's paralysis": "todds-paralysis",
            "traumatic brain injury": "traumatic-brain-injury",
            "type 1 rta": "rta",
            "type 2 rta": "rta",
            "type 4 rta": "rta",
            "viral encephalitis": "encephalitis",
            "vitamin b12 deficiency": "b12-folate-deficiency"
        };

        // Condition display names for panel title
        const conditionNames = {
            "acs": "Acute Coronary Syndrome", "heart-failure": "Heart Failure", "afib": "Atrial Fibrillation",
            "htn-emergency": "Hypertensive Emergency", "dvt": "Deep Vein Thrombosis", "syncope": "Syncope",
            "pericarditis": "Pericarditis", "endocarditis": "Endocarditis", "myocarditis": "Myocarditis",
            "cardiogenic-shock": "Cardiogenic Shock", "bradycardia": "Bradycardia", "vt-vf": "VT/VF",
            "limb-ischemia": "Acute Limb Ischemia", "cap": "Community-Acquired Pneumonia", "copd": "COPD",
            "asthma": "Asthma", "pe": "Pulmonary Embolism", "pleural-effusion": "Pleural Effusion",
            "pneumothorax": "Pneumothorax", "ild": "Interstitial Lung Disease", "hemoptysis": "Hemoptysis",
            "hypercapnic-failure": "Hypercapnic Respiratory Failure", "influenza": "Influenza", "covid": "COVID-19",
            "sepsis": "Sepsis", "cellulitis": "Cellulitis", "uti": "UTI/Pyelonephritis", "cdiff": "C. difficile",
            "meningitis": "Meningitis", "neutropenic-fever": "Neutropenic Fever", "ssti": "SSTI",
            "tb": "Tuberculosis", "hiv-aids": "HIV/AIDS", "opportunistic": "Opportunistic Infections",
            "aki": "Acute Kidney Injury", "hyperkalemia": "Hyperkalemia", "hyponatremia": "Hyponatremia",
            "siadh": "SIADH", "ckd-complications": "CKD Complications", "uremia": "Uremia",
            "hypomag": "Hypomagnesemia", "magnesium-disorders": "Magnesium Disorders", "phosphate": "Phosphate Disorders", "metabolic-alkalosis": "Metabolic Alkalosis",
            "cirrhosis": "Cirrhosis", "he": "Hepatic Encephalopathy", "sbp": "Spontaneous Bacterial Peritonitis",
            "cirrhosis-complications": "Cirrhosis Complications", "aclf": "Acute-on-Chronic Liver Failure",
            "ugib": "Upper GI Bleeding", "pancreatitis": "Pancreatitis", "bowel-obstruction": "Bowel Obstruction",
            "diverticulitis": "Diverticulitis", "ibd": "Inflammatory Bowel Disease", "acute-diarrhea": "Acute Diarrhea",
            "mesenteric-ischemia": "Mesenteric Ischemia", "dka": "DKA", "hhs": "HHS",
            "hypothyroid": "Hypothyroidism", "hyperthyroid": "Hyperthyroidism", "adrenal": "Adrenal Insufficiency",
            "diabetes-insipidus": "Diabetes Insipidus", "pheo": "Pheochromocytoma", "anemia": "Anemia",
            "hemolytic-anemia": "Hemolytic Anemia", "thrombocytopenia": "Thrombocytopenia", "dic": "DIC",
            "sickle-cell": "Sickle Cell Disease", "tls": "Tumor Lysis Syndrome", "transfusion": "Transfusion Reactions",
            "anticoag-reversal": "Anticoagulation Reversal", "onc-emergencies": "Oncologic Emergencies",
            "cord-compression": "Spinal Cord Compression", "stroke": "Stroke", "tia": "TIA", "seizure": "Seizure",
            "delirium": "Delirium", "increased-icp": "Increased ICP", "gbs": "Guillain-BarrÃ© Syndrome",
            "myasthenia": "Myasthenia Gravis", "gout": "Gout", "gca": "Giant Cell Arteritis", "sle": "SLE",
            "anaphylaxis": "Anaphylaxis", "rhabdo": "Rhabdomyolysis", "etoh-withdrawal": "Alcohol Withdrawal",
            "opioid": "Opioid Toxicity", "overdose": "Overdose/Toxicology"
        };

        // Current panel state
        let currentAnchor = null;

        // Panel functions
        function openPanel(anchor, displayText) {
            const panel = document.getElementById('slidePanel');
            const overlay = document.getElementById('panelOverlay');
            const iframe = document.getElementById('panelIframe');
            const title = document.getElementById('panelTitle');
            
            currentAnchor = anchor;
            title.textContent = conditionNames[anchor] || displayText;
            iframe.src = `im_guide.html#${anchor}`;
            
            panel.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePanel() {
            const panel = document.getElementById('slidePanel');
            const overlay = document.getElementById('panelOverlay');
            const iframe = document.getElementById('panelIframe');
            
            panel.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            currentAnchor = null;
            
            setTimeout(() => { iframe.src = 'about:blank'; }, 300);
        }

        function openFullscreen() {
            if (currentAnchor) {
                window.open(`im_guide.html#${currentAnchor}`, '_blank');
            }
        }

        // Auto-link function that creates clickable spans instead of anchor tags
        function autoLinkText(text) {
            // Helper to escape HTML special chars for attributes
            const escapeAttr = (str) => str.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            
            const sortedKeys = Object.keys(imcrgMap).sort((a, b) => b.length - a.length);
            const linkedAnchors = new Set();
            const placeholders = [];
            let result = text;
            
            // First pass: replace matches with placeholders to prevent nesting
            for (const term of sortedKeys) {
                const anchor = imcrgMap[term];
                if (linkedAnchors.has(anchor)) continue;
                
                const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`\\b(${escapedTerm})\\b`, 'gi');
                
                if (regex.test(result)) {
                    linkedAnchors.add(anchor);
                    result = result.replace(new RegExp(`\\b(${escapedTerm})\\b`, 'gi'), (match) => {
                        const idx = placeholders.length;
                        placeholders.push({anchor: anchor, match: match});
                        return `@@LINK${idx}@@`;
                    });
                }
            }
            
            // Second pass: restore placeholders with actual HTML
            placeholders.forEach((item, i) => {
                result = result.replace(`@@LINK${i}@@`, 
                    `<span class="imcrg-link" data-anchor="${escapeAttr(item.anchor)}" data-term="${escapeAttr(item.match)}">${item.match}</span>`);
            });
            
            return result;
        }

        const categoryNames = {
            electrolytes: "Electrolytes", cbc: "CBC", renal: "Renal", hepatic: "Hepatic",
            cardiac: "Cardiac", endocrine: "Endocrine", coagulation: "Coagulation",
            inflammatory: "Inflammatory", iron: "Iron Studies", lipids: "Lipids",
            abg: "ABG", bodyfluid: "Body Fluids", infectious: "Infectious",
            tumor: "Tumor Markers", drugs: "Drug Levels", misc: "Misc"
        };
        const labValues = [
            // ELECTROLYTES (1-14)
            { id: 1, name: "Hyponatremia", subtitle: "Low Sodium", category: "electrolytes", direction: "low", severity: "severe",
                thresholds: { normal: "136-145 mEq/L", mild: "130-135", moderate: "125-129", severe: "120-124", critical: "<120" },
                differential: ["SIADH (malignancy, CNS disease, pulmonary disease, drugs)", "Heart failure (dilutional)", "Cirrhosis with ascites", "Hypothyroidism", "Adrenal insufficiency", "Psychogenic polydipsia", "Thiazide diuretics", "Beer potomania"],
                management: ["Assess volume status: Hypovolemic vs euvolemic vs hypervolemic", "Check urine Na and osmolality: UNa >20 suggests renal loss or SIADH", "Chronic (>48h): Correct â‰¤8-10 mEq/L per 24h to prevent osmotic demyelination", "Acute/symptomatic: 3% saline 100-150mL bolus, recheck Na q2h", "SIADH: Fluid restrict 1-1.5L/day, consider salt tabs or tolvaptan", "Hypovolemic: NS resuscitation"]
            },
            { id: 2, name: "Hypernatremia", subtitle: "High Sodium", category: "electrolytes", direction: "high", severity: "severe",
                thresholds: { normal: "136-145 mEq/L", mild: "146-150", moderate: "151-159", severe: "160-169", critical: ">170" },
                differential: ["Dehydration/inadequate water intake", "Diabetes insipidus (central vs nephrogenic)", "Osmotic diuresis (hyperglycemia, mannitol)", "Insensible losses (fever, burns)", "GI losses (diarrhea)", "Iatrogenic (hypertonic saline, sodium bicarbonate)"],
                management: ["Calculate free water deficit: 0.6 Ã— weight Ã— (Na/140 - 1)", "Correct slowly: â‰¤10-12 mEq/L per 24h to prevent cerebral edema", "Replace with D5W or 0.45% saline", "Central DI: Desmopressin 1-2 mcg IV/SC q12h", "Treat underlying cause"]
            },
            { id: 3, name: "Hypokalemia", subtitle: "Low Potassium", category: "electrolytes", direction: "low", severity: "severe",
                thresholds: { normal: "3.5-5.0 mEq/L", mild: "3.0-3.4", moderate: "2.5-2.9", severe: "<2.5", critical: "<2.0" },
                differential: ["Diuretics (thiazides, loops)", "GI losses (vomiting, diarrhea, NG suction)", "Renal tubular acidosis", "Hyperaldosteronism", "Hypomagnesemia (causes refractory hypokalemia)", "DKA treatment", "Refeeding syndrome", "Alcohol withdrawal"],
                management: ["Check magnesium - must replete Mg for K repletion to work", "Mild (3.0-3.4): Oral KCl 40-80 mEq/day", "Moderate (2.5-2.9): IV KCl 10-20 mEq/hr (max 40 mEq/hr via central line)", "Severe (<2.5): Continuous cardiac monitoring, aggressive IV repletion", "Each 10 mEq KCl raises serum K by ~0.1 mEq/L"]
            },
            { id: 4, name: "Hyperkalemia", subtitle: "High Potassium", category: "electrolytes", direction: "high", severity: "critical",
                thresholds: { normal: "3.5-5.0 mEq/L", mild: "5.1-5.5", moderate: "5.6-6.0", severe: "6.1-6.9", critical: "â‰¥7.0" },
                differential: ["AKI or CKD", "Medications (ACEi, ARB, K-sparing diuretics, NSAIDs, TMP-SMX)", "Rhabdomyolysis", "Tumor lysis syndrome", "Acidosis (transcellular shift)", "Adrenal insufficiency", "Pseudohyperkalemia (hemolyzed sample, thrombocytosis)"],
                management: ["ECG immediately if K >6.0 or symptomatic", "Cardiac membrane stabilization: Calcium gluconate 1-2g IV over 2-3 min", "Shift K intracellularly: Insulin 10U + D50 50mL; Albuterol nebs 10-20mg", "Remove K: Kayexalate 30-60g PO, Lokelma 10g, Furosemide, Dialysis if refractory", "Stop offending medications"]
            },
            { id: 5, name: "Hypocalcemia", subtitle: "Low Calcium", category: "electrolytes", direction: "low", severity: "severe",
                thresholds: { normal: "8.5-10.5 mg/dL", mild: "7.5-8.4", moderate: "7.0-7.4", severe: "<7.0", critical: "<6.0" },
                differential: ["Hypoparathyroidism (post-thyroidectomy)", "Vitamin D deficiency", "CKD", "Acute pancreatitis", "Hypomagnesemia", "Hungry bone syndrome", "Rhabdomyolysis", "Tumor lysis syndrome", "Sepsis", "Massive transfusion (citrate)"],
                management: ["Correct for albumin: Corrected Ca = measured Ca + 0.8 Ã— (4 - albumin)", "Symptomatic/severe: Calcium gluconate 1-2g IV over 10-20 min, then infusion 0.5-1.5 mg/kg/hr", "Check and replete magnesium", "Oral: Calcium carbonate 1-2g TID + Vitamin D", "Monitor for QT prolongation"]
            },
            { id: 6, name: "Hypercalcemia", subtitle: "High Calcium", category: "electrolytes", direction: "high", severity: "severe",
                thresholds: { normal: "8.5-10.5 mg/dL", mild: "10.5-12.0", moderate: "12.1-14.0", severe: "14.1-16.0", critical: ">16.0" },
                differential: ["Primary hyperparathyroidism (outpatient, PTH elevated)", "Malignancy (PTHrP, bone mets, myeloma)", "Granulomatous disease (sarcoid, TB)", "Vitamin D toxicity", "Thiazide diuretics", "Milk-alkali syndrome", "Immobilization", "Thyrotoxicosis"],
                management: ["Aggressive IV fluids: NS 200-300 mL/hr initially", "Loop diuretics (after volume replete): Furosemide 20-40mg IV", "Bisphosphonates: Zoledronic acid 4mg IV or Pamidronate 60-90mg IV", "Calcitonin 4 U/kg q12h for rapid effect (tachyphylaxis in 48h)", "Denosumab if refractory", "Dialysis if severe/refractory", "Treat underlying cause"]
            },
            { id: 7, name: "Hypomagnesemia", subtitle: "Low Magnesium", category: "electrolytes", direction: "low", severity: "moderate",
                thresholds: { normal: "1.7-2.4 mg/dL", mild: "1.4-1.6", moderate: "1.0-1.3", severe: "<1.0", critical: "<0.5" },
                differential: ["Diuretics (loops, thiazides)", "Alcohol use disorder", "GI losses (diarrhea, malabsorption)", "PPI use (long-term)", "Refeeding syndrome", "DKA", "Aminoglycosides, amphotericin, cisplatin", "Hungry bone syndrome"],
                management: ["Causes refractory hypokalemia and hypocalcemia - must replete Mg first", "Mild/asymptomatic: Magnesium oxide 400-800mg PO TID", "Moderate/severe: Magnesium sulfate 1-2g IV over 1 hour", "Severe/symptomatic (seizures, arrhythmias): MgSO4 2-4g IV over 5-15 min", "Recheck levels 24h after repletion"]
            },
            { id: 8, name: "Hypermagnesemia", subtitle: "High Magnesium", category: "electrolytes", direction: "high", severity: "severe",
                thresholds: { normal: "1.7-2.4 mg/dL", mild: "2.5-4.0", moderate: "4.1-6.0", severe: "6.1-10.0", critical: ">10.0" },
                differential: ["Renal failure (most common)", "Iatrogenic (Mg-containing antacids/laxatives, IV magnesium)", "Adrenal insufficiency", "Lithium toxicity", "Tumor lysis syndrome"],
                management: ["Stop all magnesium-containing products", "IV calcium gluconate 1-2g for cardiac membrane stabilization", "NS diuresis if renal function adequate", "Hemodialysis if severe or renal failure", "Support ventilation if respiratory depression"]
            },
            { id: 9, name: "Hypophosphatemia", subtitle: "Low Phosphate", category: "electrolytes", direction: "low", severity: "moderate",
                thresholds: { normal: "2.5-4.5 mg/dL", mild: "2.0-2.4", moderate: "1.0-1.9", severe: "<1.0", critical: "<0.5" },
                differential: ["Refeeding syndrome", "DKA treatment", "Respiratory alkalosis", "Alcohol withdrawal", "Vitamin D deficiency", "Hyperparathyroidism", "Malabsorption", "Phosphate binders"],
                management: ["Mild (2.0-2.4): Oral phosphate 1-2g/day (Neutra-Phos, K-Phos)", "Moderate (1.0-1.9): IV potassium phosphate 15-30 mmol over 6h", "Severe (<1.0): IV phosphate 30-45 mmol over 6h with cardiac monitoring", "Monitor calcium (phosphate binds Ca)", "Treat underlying cause"]
            },
            { id: 10, name: "Hyperphosphatemia", subtitle: "High Phosphate", category: "electrolytes", direction: "high", severity: "moderate",
                thresholds: { normal: "2.5-4.5 mg/dL", mild: "4.6-5.5", moderate: "5.6-7.0", severe: ">7.0", critical: ">10" },
                differential: ["CKD/ESRD (most common)", "Tumor lysis syndrome", "Rhabdomyolysis", "Hypoparathyroidism", "Acidosis", "Excessive phosphate intake (enemas, supplements)"],
                management: ["Dietary phosphate restriction <800mg/day", "Phosphate binders with meals: Calcium acetate, sevelamer, lanthanum", "Dialysis if severe or symptomatic", "Treat underlying cause (TLS, rhabdo)", "Monitor for hypocalcemia and metastatic calcification"]
            },
            { id: 11, name: "Hypochloremia", subtitle: "Low Chloride", category: "electrolytes", direction: "low", severity: "moderate",
                thresholds: { normal: "96-106 mEq/L", mild: "90-95", moderate: "85-89", severe: "<85", critical: "<80" },
                differential: ["Vomiting/NG suction (loss of HCl)", "Diuretics", "Metabolic alkalosis", "SIADH", "Respiratory acidosis compensation", "CF"],
                management: ["Usually follows sodium - treat hyponatremia", "If metabolic alkalosis: NS with KCl", "Severe vomiting: Antiemetics, IV fluids with chloride", "Correct underlying cause"]
            },
            { id: 12, name: "Hyperchloremia", subtitle: "High Chloride", category: "electrolytes", direction: "high", severity: "moderate",
                thresholds: { normal: "96-106 mEq/L", mild: "107-110", moderate: "111-115", severe: ">115", critical: ">120" },
                differential: ["Non-anion gap metabolic acidosis (diarrhea, RTA)", "Excessive NS administration", "Respiratory alkalosis compensation", "Dehydration", "Medications (acetazolamide)"],
                management: ["Calculate anion gap to determine cause", "If from NS: Switch to balanced crystalloid (LR)", "Treat underlying acidosis", "RTA: Bicarbonate supplementation"]
            },
            { id: 13, name: "Low Bicarbonate", subtitle: "Metabolic Acidosis", category: "electrolytes", direction: "low", severity: "severe",
                thresholds: { normal: "22-28 mEq/L", mild: "18-21", moderate: "14-17", severe: "10-13", critical: "<10" },
                differential: ["<b>Elevated anion gap:</b> DKA, lactic acidosis (sepsis, shock), uremia, toxic ingestions (methanol, ethylene glycol, salicylates)", "<b>Normal anion gap:</b> Diarrhea, RTA, early CKD, acetazolamide, NS infusion"],
                management: ["Calculate anion gap: Na - (Cl + HCO3), normal 8-12", "Identify and treat underlying cause", "DKA: Insulin, IV fluids, K repletion", "Lactic acidosis: Treat sepsis/shock", "Consider bicarbonate only if pH <7.1 or HCO3 <8"]
            },
            { id: 14, name: "High Bicarbonate", subtitle: "Metabolic Alkalosis", category: "electrolytes", direction: "high", severity: "moderate",
                thresholds: { normal: "22-28 mEq/L", mild: "29-32", moderate: "33-38", severe: ">38", critical: ">45" },
                differential: ["<b>Chloride-responsive (UCl <20):</b> Vomiting, NG suction, diuretics", "<b>Chloride-resistant (UCl >20):</b> Hyperaldosteronism, Cushing syndrome, severe hypokalemia, Bartter/Gitelman syndrome"],
                management: ["Check urine chloride to categorize", "Chloride-responsive: NS with KCl", "Chloride-resistant: Treat underlying cause, spironolactone", "Severe (pH >7.55): Consider acetazolamide 250-500mg, or dilute HCl via central line"]
            },

            // CBC (15-24)
            { id: 15, name: "Anemia", subtitle: "Low Hemoglobin", category: "cbc", direction: "low", severity: "moderate",
                thresholds: { normal: "M:13.5-17.5, F:12-16 g/dL", mild: "10-12", moderate: "8-9.9", severe: "6.5-7.9", critical: "<6.5" },
                differential: ["<b>Microcytic (MCV<80):</b> Iron deficiency, thalassemia, anemia of chronic disease, sideroblastic", "<b>Normocytic:</b> Acute blood loss, anemia of chronic disease, CKD, hemolysis, bone marrow failure", "<b>Macrocytic (MCV>100):</b> B12/folate deficiency, alcohol, hypothyroidism, MDS, medications (methotrexate)"],
                management: ["Check MCV, reticulocyte count, iron studies, B12/folate", "Iron deficiency: Ferrous sulfate 325mg TID or IV iron", "B12 deficiency: Cyanocobalamin 1000mcg IM weekly x4, then monthly", "Transfuse if Hgb <7 (or <8 with cardiac disease/symptoms)"]
            },
            { id: 16, name: "Polycythemia", subtitle: "High Hemoglobin/Hematocrit", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "M:13.5-17.5, F:12-16 g/dL", mild: "17-18", moderate: "18-20", severe: ">20", critical: ">22" },
                differential: ["<b>Primary:</b> Polycythemia vera (JAK2 mutation)", "<b>Secondary:</b> Chronic hypoxia (COPD, OSA, high altitude), EPO-producing tumors (renal cell, hepatocellular)", "<b>Relative:</b> Dehydration, diuretics"],
                management: ["Check EPO level, JAK2 mutation, oxygen saturation", "PV: Phlebotomy to Hct <45%, low-dose aspirin, hydroxyurea if high-risk", "Secondary: Treat underlying cause (oxygen, CPAP)", "Relative: IV fluids"]
            },
            { id: 17, name: "Thrombocytopenia", subtitle: "Low Platelets", category: "cbc", direction: "low", severity: "severe",
                thresholds: { normal: "150-400 K/Î¼L", mild: "100-149", moderate: "50-99", severe: "20-49", critical: "<20" },
                differential: ["<b>Decreased production:</b> Bone marrow failure, B12/folate deficiency, chemotherapy, alcohol", "<b>Increased destruction:</b> ITP, TTP, HUS, DIC, HIT, drugs (heparin, antibiotics)", "<b>Sequestration:</b> Splenomegaly, cirrhosis", "<b>Dilutional:</b> Massive transfusion"],
                management: ["Review medication list (heparin, antibiotics)", "Check peripheral smear, coagulation studies", "ITP: Steroids, IVIG, romiplostim", "TTP: Urgent plasma exchange", "HIT: Stop all heparin, start argatroban/bivalirudin", "Transfuse platelets if <10K or <50K with bleeding/procedure"]
            },
            { id: 18, name: "Thrombocytosis", subtitle: "High Platelets", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "150-400 K/Î¼L", mild: "400-600", moderate: "600-1000", severe: ">1000", critical: ">1500" },
                differential: ["<b>Reactive (most common):</b> Infection, inflammation, iron deficiency, malignancy, post-splenectomy, recovery from thrombocytopenia", "<b>Primary:</b> Essential thrombocythemia, polycythemia vera, CML"],
                management: ["Reactive: Treat underlying cause", "Primary: Hematology consult, JAK2/CALR mutation testing", "Aspirin for primary thrombocytosis if no bleeding", "Hydroxyurea if very high or high-risk"]
            },
            { id: 19, name: "Leukocytosis", subtitle: "High WBC", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "4-11 K/Î¼L", mild: "11-15", moderate: "15-25", severe: "25-50", critical: ">50" },
                differential: ["<b>Neutrophilia:</b> Infection, inflammation, stress (steroids), CML, medications", "<b>Lymphocytosis:</b> Viral infection, CLL, pertussis", "<b>Eosinophilia:</b> Allergies, parasites, drugs, malignancy", "Leukemoid reaction vs leukemia"],
                management: ["Check differential", "Infection: Cultures, antibiotics", "WBC >100K: Concern for leukostasis - hematology emergency", "Check peripheral smear for blasts"]
            },
            { id: 20, name: "Leukopenia/Neutropenia", subtitle: "Low WBC/ANC", category: "cbc", direction: "low", severity: "severe",
                thresholds: { normal: "ANC >1500/Î¼L", mild: "1000-1500", moderate: "500-999", severe: "200-499", critical: "<200" },
                differential: ["Chemotherapy/medications", "Bone marrow failure (aplastic anemia, MDS, leukemia)", "Viral infections (HIV, EBV, CMV, hepatitis)", "Autoimmune (lupus, Felty syndrome)", "Nutritional (B12, folate, copper deficiency)", "Sepsis (consumption)"],
                management: ["Review medications", "ANC <500: Neutropenic precautions, low threshold for antibiotics", "Febrile neutropenia: Blood cultures, empiric broad-spectrum antibiotics immediately", "Consider G-CSF for severe/prolonged neutropenia"]
            },
            { id: 21, name: "Elevated MCV", subtitle: "Macrocytosis", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "80-100 fL", mild: "100-105", moderate: "105-115", severe: ">115", critical: ">130" },
                differential: ["B12 deficiency (check methylmalonic acid)", "Folate deficiency", "Alcohol use", "Hypothyroidism", "Liver disease", "Medications (methotrexate, azathioprine, hydroxyurea)", "MDS", "Reticulocytosis"],
                management: ["Check B12, folate, TSH, reticulocyte count", "B12 deficiency: IM supplementation, evaluate for pernicious anemia", "Alcohol: Abstinence, typically improves in weeks", "Review medications"]
            },
            { id: 22, name: "Low MCV", subtitle: "Microcytosis", category: "cbc", direction: "low", severity: "moderate",
                thresholds: { normal: "80-100 fL", mild: "75-79", moderate: "70-74", severe: "<70", critical: "<60" },
                differential: ["Iron deficiency (most common)", "Thalassemia trait", "Anemia of chronic disease", "Sideroblastic anemia", "Lead poisoning"],
                management: ["Check iron studies (ferritin, TIBC, serum iron)", "Iron deficiency: Oral iron, evaluate for GI blood loss (colonoscopy)", "Thalassemia: Mentzer index (MCV/RBC) <13 suggests thalassemia", "Hemoglobin electrophoresis if thalassemia suspected"]
            },
            { id: 23, name: "Elevated RDW", subtitle: "Red Cell Distribution Width", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "11.5-14.5%", mild: "14.5-16", moderate: "16-20", severe: ">20", critical: "N/A" },
                differential: ["Iron deficiency anemia", "B12/folate deficiency", "Mixed deficiency", "Hemolytic anemia", "Recent transfusion", "Myelodysplastic syndrome", "Post-chemotherapy"],
                management: ["Indicates variation in RBC size (anisocytosis)", "Helps distinguish iron deficiency (high RDW) from thalassemia (normal RDW)", "Evaluate for underlying cause of anemia", "High RDW with normal MCV suggests early/mixed deficiency"]
            },
            { id: 24, name: "Elevated Reticulocytes", subtitle: "Reticulocyte Count", category: "cbc", direction: "high", severity: "moderate",
                thresholds: { normal: "0.5-2.5%", mildHigh: "2.5-5%", modHigh: "5-10%", high: ">10%", low: "<0.5%" },
                differential: ["<b>Elevated:</b> Hemolytic anemia, acute blood loss, response to treatment (iron, B12)", "<b>Low:</b> Bone marrow failure, aplastic anemia, chemotherapy, nutritional deficiency"],
                management: ["Calculate reticulocyte index: Retic% Ã— (Hct/45) Ã— 0.5 (if stress reticulocytosis)", "Elevated retics = marrow responding appropriately (hemolysis, blood loss)", "Low retics = marrow problem (production failure)", "If hemolysis suspected: Check LDH, haptoglobin, bilirubin, Coombs test"]
            },

            // RENAL (25-30)
            { id: 25, name: "Elevated Creatinine", subtitle: "Acute Kidney Injury", category: "renal", direction: "high", severity: "severe",
                thresholds: { normal: "0.6-1.2 mg/dL", stage1: "1.5-1.9Ã— baseline", stage2: "2-2.9Ã— baseline", stage3: "â‰¥3Ã— or â‰¥4.0 mg/dL", dialysis: "Need for RRT" },
                differential: ["<b>Pre-renal:</b> Hypovolemia, heart failure, sepsis, hepatorenal syndrome, NSAIDs, ACEi/ARB", "<b>Intrinsic:</b> ATN, AIN (drugs), glomerulonephritis, contrast nephropathy", "<b>Post-renal:</b> BPH, stones, malignancy, neurogenic bladder"],
                management: ["Assess volume status, bladder scan for obstruction", "Check urine sediment, FENa, urine eosinophils", "FENa <1% = pre-renal; FENa >2% = intrinsic (ATN)", "Pre-renal: IV fluids, hold nephrotoxins", "Obstruction: Foley, urology consult", "Indications for dialysis: AEIOU (Acidosis, Electrolytes, Intoxication, Overload, Uremia)"]
            },
            { id: 26, name: "Elevated BUN", subtitle: "Blood Urea Nitrogen", category: "renal", direction: "high", severity: "moderate",
                thresholds: { normal: "7-20 mg/dL", mild: "21-40", moderate: "41-80", severe: ">80", critical: ">100" },
                differential: ["<b>Pre-renal azotemia (BUN:Cr >20:1):</b> Dehydration, GI bleeding, high protein intake, catabolic states, heart failure", "<b>Renal failure:</b> AKI, CKD (BUN:Cr ~10-15:1)", "Medications (steroids, tetracyclines)"],
                management: ["Interpret with creatinine (BUN:Cr ratio)", "BUN:Cr >20:1 suggests pre-renal cause or GI bleed", "GI bleed: Blood is protein load â†’ elevated BUN", "Treat underlying cause"]
            },
            { id: 27, name: "Low eGFR", subtitle: "CKD Staging", category: "renal", direction: "low", severity: "severe",
                thresholds: { normal: ">90", stage1: ">90 + markers", stage2: "60-89", stage3a: "45-59", stage3b: "30-44", stage4: "15-29", stage5: "<15" },
                differential: ["Diabetic nephropathy", "Hypertensive nephrosclerosis", "Glomerulonephritis", "Polycystic kidney disease", "Obstructive uropathy", "Chronic interstitial nephritis"],
                management: ["Check urine albumin:creatinine ratio", "BP control (<130/80 with ACEi/ARB if proteinuria)", "Diabetes control (A1c <7%)", "Avoid nephrotoxins (NSAIDs, contrast)", "Stage 4-5: Nephrology referral, prepare for RRT/transplant", "Manage complications: anemia (EPO), bone disease (phos binders, vit D)"]
            },
            { id: 28, name: "Proteinuria", subtitle: "Urine Protein", category: "renal", direction: "high", severity: "moderate",
                thresholds: { normal: "<150 mg/day", microalbumin: "30-300 mg/day", overt: ">300 mg/day", nephrotic: ">3.5 g/day" },
                differential: ["Diabetic nephropathy", "Glomerulonephritis (IgA, FSGS, membranous)", "Hypertensive nephrosclerosis", "Multiple myeloma (light chains)", "Orthostatic proteinuria (benign)", "Transient (fever, exercise, heart failure)"],
                management: ["Spot urine protein:creatinine ratio (approximates 24h)", "ACEi/ARB for diabetic/proteinuric CKD", "Nephrotic range: Check lipids, albumin, consider renal biopsy", "Screen for secondary causes: HBV, HCV, HIV, SPEP/UPEP"]
            },
            { id: 29, name: "Hematuria", subtitle: "Blood in Urine", category: "renal", direction: "high", severity: "moderate",
                thresholds: { normal: "<3 RBC/hpf", microscopic: "3-50 RBC/hpf", gross: ">50 or visible" },
                differential: ["UTI/pyelonephritis", "Nephrolithiasis", "Malignancy (bladder, renal, prostate)", "Glomerulonephritis (dysmorphic RBCs, RBC casts)", "BPH", "Trauma", "Anticoagulation", "Exercise-induced"],
                management: ["Confirm with microscopy (rule out myoglobinuria)", "Dysmorphic RBCs/RBC casts = glomerular source", "Age >40 with gross hematuria: Cystoscopy + CT urogram (rule out malignancy)", "UTI: Treat and recheck", "Persistent microscopic: Consider urology referral"]
            },
            { id: 30, name: "Urine Sodium/FENa", subtitle: "Fractional Excretion", category: "renal", direction: "low", severity: "moderate",
                thresholds: { prerenal: "<1% or UNa <20", intrinsic: ">2% or UNa >40", intermediate: "1-2%" },
                differential: ["<b>FENa <1%:</b> Pre-renal (hypovolemia, heart failure), hepatorenal syndrome, early obstruction, contrast nephropathy, pigment nephropathy", "<b>FENa >2%:</b> ATN, AIN, post-obstructive", "<b>Exceptions:</b> Diuretics invalidate FENa - use FEUrea instead"],
                management: ["FENa = (UNa Ã— PCr) / (PNa Ã— UCr) Ã— 100", "Use FEUrea if on diuretics: <35% = pre-renal", "Low FENa with AKI: Aggressive volume resuscitation", "High FENa: Likely intrinsic renal disease, supportive care", "Does not apply to CKD (chronically elevated FENa)"]
            },

            // HEPATIC (31-40)
            { id: 31, name: "Elevated AST/ALT", subtitle: "Hepatocellular Injury", category: "hepatic", direction: "high", severity: "moderate",
                thresholds: { normal: "AST 10-40, ALT 7-56 U/L", mild: "1-3Ã— ULN", moderate: "3-10Ã— ULN", severe: "10-20Ã— ULN", critical: ">20Ã— ULN" },
                differential: ["<b>Mild-moderate:</b> NAFLD/NASH, alcohol, chronic viral hepatitis (HBV, HCV), medications, hemochromatosis, autoimmune hepatitis", "<b>Marked elevation (>1000):</b> Acute viral hepatitis, ischemic hepatitis, drug-induced (acetaminophen), autoimmune flare, Budd-Chiari"],
                management: ["AST:ALT >2:1 suggests alcoholic liver disease", "Check viral hepatitis serologies, acetaminophen level, autoimmune markers (ANA, anti-smooth muscle)", "Ischemic hepatitis: Very high ALT, rapid rise and fall, hypotension history", "Acetaminophen: NAC protocol if indicated"]
            },
            { id: 32, name: "Elevated Bilirubin", subtitle: "Hyperbilirubinemia", category: "hepatic", direction: "high", severity: "moderate",
                thresholds: { normal: "Total 0.1-1.2 mg/dL", mild: "1.2-3", moderate: "3-10", severe: "10-20", critical: ">20" },
                differential: ["<b>Unconjugated (indirect):</b> Hemolysis, Gilbert syndrome, ineffective erythropoiesis", "<b>Conjugated (direct):</b> Hepatocellular disease, biliary obstruction, sepsis, TPN", "<b>Mixed:</b> Cirrhosis, hepatitis"],
                management: ["Fractionate bilirubin (direct vs indirect)", "Indirect predominant: Check hemolysis labs (LDH, haptoglobin, reticulocytes)", "Direct predominant: Imaging (RUQ US, MRCP) for obstruction", "Obstruction: ERCP for stone removal or stent placement", "Hepatocellular: Supportive care, treat underlying cause"]
            },
            { id: 33, name: "Elevated Alkaline Phosphatase", subtitle: "Cholestatic Pattern", category: "hepatic", direction: "high", severity: "moderate",
                thresholds: { normal: "44-147 U/L", mild: "1-2Ã— ULN", moderate: "2-3Ã— ULN", severe: ">3Ã— ULN" },
                differential: ["<b>Hepatobiliary:</b> Biliary obstruction, primary biliary cholangitis, primary sclerosing cholangitis, infiltrative disease, medications", "<b>Non-hepatic:</b> Bone disease (Paget's, fractures, metastases), pregnancy, growth, hyperparathyroidism"],
                management: ["Check GGT to confirm hepatic source (GGT elevated = hepatic)", "If hepatic: RUQ ultrasound, consider MRCP", "Isolated elevated alk phos with normal GGT: Consider bone source (check bone-specific alk phos)", "PBC: Anti-mitochondrial antibody, ursodiol treatment"]
            },
            { id: 34, name: "Elevated GGT", subtitle: "Gamma-Glutamyl Transferase", category: "hepatic", direction: "high", severity: "moderate",
                thresholds: { normal: "M 8-61, F 5-36 U/L", mild: "1-2Ã— ULN", moderate: "2-5Ã— ULN", severe: ">5Ã— ULN" },
                differential: ["Alcohol use (very sensitive)", "Biliary disease", "Medications (phenytoin, carbamazepine, barbiturates)", "NAFLD", "Pancreatic disease", "Heart failure"],
                management: ["Useful to confirm hepatic source of elevated alk phos", "Elevated GGT alone: Often alcohol or medications", "Combined with elevated alk phos: Suggests biliary pathology", "Consider imaging if cholestatic pattern"]
            },
            { id: 35, name: "Low Albumin", subtitle: "Hypoalbuminemia", category: "hepatic", direction: "low", severity: "moderate",
                thresholds: { normal: "3.5-5.0 g/dL", mild: "3.0-3.4", moderate: "2.5-2.9", severe: "2.0-2.4", critical: "<2.0" },
                differential: ["Liver disease (decreased synthesis)", "Nephrotic syndrome (urinary losses)", "Malnutrition/malabsorption", "Protein-losing enteropathy", "Inflammation/sepsis (negative acute phase)", "Burns", "Dilutional (IV fluids, pregnancy)"],
                management: ["Poor prognostic marker in cirrhosis (part of MELD, Child-Pugh)", "Correct calcium for low albumin", "Nephrotic: ACEi/ARB, treat underlying cause", "Not typically repleted unless specific indication (SBP prophylaxis with albumin)", "Address underlying cause"]
            },
            { id: 36, name: "Elevated Ammonia", subtitle: "Hyperammonemia", category: "hepatic", direction: "high", severity: "severe",
                thresholds: { normal: "15-45 Î¼g/dL", mild: "45-80", moderate: "80-150", severe: ">150", critical: ">200" },
                differential: ["Hepatic encephalopathy (cirrhosis)", "Acute liver failure", "Portosystemic shunts (TIPS)", "Urea cycle disorders", "GI bleeding (protein load)", "Infection/constipation precipitants", "Medications (valproate)"],
                management: ["Treat hepatic encephalopathy: Lactulose 30mL q1-2h until bowel movement, then titrate to 2-3 BM/day", "Rifaximin 550mg BID for recurrent HE", "Identify and treat precipitants: Infection, GI bleed, constipation, medications", "Protein restriction NOT recommended (maintains muscle mass)", "Consider zinc supplementation"]
            },
            { id: 37, name: "Elevated INR", subtitle: "Coagulopathy - Liver", category: "hepatic", direction: "high", severity: "severe",
                thresholds: { normal: "0.9-1.1", mild: "1.1-1.5", moderate: "1.5-2.0", severe: "2.0-3.0", critical: ">3.0" },
                differential: ["Liver synthetic dysfunction (acute or chronic)", "Vitamin K deficiency (malnutrition, malabsorption, antibiotics)", "Warfarin therapy", "DIC", "Factor deficiencies"],
                management: ["Distinguish liver disease from vitamin K deficiency: Give vitamin K 10mg IV Ã— 1-3 days", "Vitamin K deficiency: INR corrects within 24-48h", "Liver disease: Minimal response to vitamin K", "Active bleeding: FFP, PCC, consider cryoprecipitate if fibrinogen low", "Not indication for FFP if not bleeding (liver disease)"]
            },
            { id: 38, name: "Elevated Lipase", subtitle: "Pancreatitis", category: "hepatic", direction: "high", severity: "severe",
                thresholds: { normal: "0-160 U/L", diagnostic: ">3Ã— ULN", mild: "3-5Ã— ULN", moderate: "5-10Ã— ULN", severe: ">10Ã— ULN" },
                differential: ["Acute pancreatitis (gallstones, alcohol, drugs, hypertriglyceridemia)", "Chronic pancreatitis", "Pancreatic malignancy", "Renal failure (decreased clearance)", "Bowel obstruction/perforation", "DKA"],
                management: ["Lipase >3Ã— ULN with compatible symptoms = pancreatitis", "Severity: BISAP score, CT severity index", "Supportive care: NPO initially, IV fluids (LR preferred), pain control", "Gallstone pancreatitis: ERCP within 24h if cholangitis, cholecystectomy same admission", "Assess and treat complications (necrosis, pseudocyst, infection)"]
            },
            { id: 39, name: "Ascitic Fluid Analysis", subtitle: "SAAG/SBP Workup", category: "hepatic", direction: "high", severity: "severe",
                thresholds: { saagHigh: "â‰¥1.1 g/dL (portal HTN)", saagLow: "<1.1 g/dL", sbpCells: "PMN â‰¥250/mmÂ³" },
                differential: ["<b>SAAG â‰¥1.1:</b> Cirrhosis, heart failure, Budd-Chiari, portal vein thrombosis", "<b>SAAG <1.1:</b> Malignancy (peritoneal carcinomatosis), TB peritonitis, nephrotic syndrome, pancreatitis"],
                management: ["SAAG = Serum albumin - Ascitic albumin", "Always check cell count, culture (inoculate at bedside)", "SBP diagnosis: PMN â‰¥250/mmÂ³ or positive culture", "SBP treatment: Ceftriaxone 2g IV daily Ã— 5 days + albumin (1.5 g/kg day 1, 1 g/kg day 3)", "SBP prophylaxis: Norfloxacin or TMP-SMX if prior SBP or high-risk"]
            },
            { id: 40, name: "Elevated Procalcitonin", subtitle: "Bacterial Infection Marker", category: "hepatic", direction: "high", severity: "moderate",
                thresholds: { normal: "<0.1 ng/mL", unlikely: "<0.25", possible: "0.25-0.5", likely: "0.5-2.0", severe: ">2.0", critical: ">10" },
                differential: ["Bacterial infection (especially sepsis, pneumonia)", "Fungal infections (less reliable)", "Post-operative/trauma", "Burns", "Cardiogenic shock", "NOT typically elevated in viral infections"],
                management: ["<0.25: Bacterial infection unlikely, consider stopping/avoiding antibiotics", ">0.5: Bacterial infection likely, supports antibiotic therapy", "Serial trending useful for antibiotic stewardship", "Can guide duration of antibiotics (stop when <0.25 or 80% decrease)", "False positives: Surgery, trauma, renal failure"]
            },

            // CARDIAC (41-45)
            { id: 41, name: "Elevated Troponin", subtitle: "Myocardial Injury", category: "cardiac", direction: "high", severity: "critical",
                thresholds: { normal: "<0.04 ng/mL (varies)", elevated: "Above 99th percentile", mildRise: "1-3Ã— ULN", modRise: "3-10Ã— ULN", highRise: ">10Ã— ULN" },
                differential: ["<b>Type 1 MI:</b> Plaque rupture, coronary thrombosis", "<b>Type 2 MI:</b> Supply-demand mismatch (tachycardia, hypotension, anemia, hypoxia, sepsis)", "<b>Non-ischemic:</b> Myocarditis, PE, heart failure, takotsubo, renal failure, cardiac contusion"],
                management: ["Check ECG, repeat troponin in 3-6 hours (high-sensitivity assays)", "Rising/falling pattern suggests acute injury", "Type 1 MI: ASA, anticoagulation, cardiology consult, cath lab if STEMI", "Type 2 MI: Treat underlying cause (transfuse, rate control, etc.)", "Chronically elevated in CKD - trend is key"]
            },
            { id: 42, name: "Elevated BNP/NT-proBNP", subtitle: "Heart Failure Marker", category: "cardiac", direction: "high", severity: "moderate",
                thresholds: { bnpNormal: "<100 pg/mL", bnpGray: "100-400", bnpHF: ">400", ntNormal: "<300 (age-adjusted)", ntHF: ">900 (>50yo)" },
                differential: ["Heart failure (systolic or diastolic)", "Acute coronary syndrome", "Pulmonary embolism", "Pulmonary hypertension", "Atrial fibrillation", "Renal failure (decreased clearance)", "Sepsis"],
                management: ["BNP <100 or NT-proBNP <300: HF unlikely (high NPV)", "Higher values support HF diagnosis", "Obesity: May have lower values despite HF", "Renal failure: Higher baseline (use NT-proBNP cutoffs)", "Serial monitoring useful for HF management", "Don't use for screening asymptomatic patients"]
            },
            { id: 43, name: "Elevated D-dimer", subtitle: "Fibrin Degradation", category: "cardiac", direction: "high", severity: "moderate",
                thresholds: { normal: "<500 ng/mL (age-adjusted: age Ã— 10 if >50)", elevated: ">500", veryHigh: ">4000" },
                differential: ["VTE (DVT, PE)", "DIC", "Sepsis/infection", "Malignancy", "Pregnancy", "Recent surgery/trauma", "Atrial fibrillation", "Heart failure", "Aortic dissection"],
                management: ["Use age-adjusted cutoff: Age Ã— 10 for patients >50 years", "High sensitivity, low specificity - best to RULE OUT PE/DVT", "Low/intermediate pretest probability + negative D-dimer = VTE excluded", "High pretest probability: Go directly to imaging", "Very elevated (>4000): Consider DIC, sepsis, malignancy"]
            },
            { id: 44, name: "Elevated CK/CK-MB", subtitle: "Muscle Injury", category: "cardiac", direction: "high", severity: "moderate",
                thresholds: { ckNormal: "M 52-336, F 38-176 U/L", ckmb: "<5% of total CK", mildCK: "1-5Ã— ULN", modCK: "5-10Ã— ULN", severeCK: ">10Ã— ULN", rhabdo: ">5000" },
                differential: ["<b>CK elevation:</b> Rhabdomyolysis, strenuous exercise, myositis, hypothyroidism, medications (statins), trauma, seizures, MI", "<b>CK-MB:</b> MI, myocarditis, cardiac surgery (troponin now preferred)"],
                management: ["CK >5000: Rhabdomyolysis - aggressive IVF, monitor renal function, urine output", "CK-MB largely replaced by troponin for MI diagnosis", "CK-MB/CK ratio >2.5-3% suggests cardiac source", "Statin myopathy: CK typically <10Ã— ULN, discontinue statin if symptomatic", "Check TSH if unexplained CK elevation"]
            },
            { id: 45, name: "Elevated Lactate", subtitle: "Tissue Hypoperfusion", category: "cardiac", direction: "high", severity: "severe",
                thresholds: { normal: "0.5-2.0 mmol/L", mild: "2-4", severe: ">4", critical: ">10" },
                differential: ["<b>Type A (hypoxic):</b> Sepsis, cardiogenic shock, hypovolemic shock, severe hypoxemia, mesenteric ischemia, limb ischemia", "<b>Type B (non-hypoxic):</b> Liver failure, medications (metformin, linezolid, propofol), malignancy, seizures, thiamine deficiency"],
                management: ["Lactate >4 mmol/L in sepsis = septic shock definition (even with normal BP)", "Serial lactate clearance: Goal >10% decrease per 2 hours", "Identify and treat source: Resuscitation, source control, antibiotics if sepsis", "Metformin-associated: Hold metformin, support, consider dialysis", "Thiamine deficiency: Thiamine 100mg IV", "Lactate clearance predicts mortality better than single value"]
            },

            // ENDOCRINE (46-55)
            { id: 46, name: "Hyperglycemia", subtitle: "DKA/HHS", category: "endocrine", direction: "high", severity: "critical",
                thresholds: { normal: "70-100 mg/dL fasting", preDM: "100-125", diabetes: ">126", dka: ">250 + ketones + acidosis", hhs: ">600 + hyperosmolar" },
                differential: ["<b>DKA:</b> Type 1 DM, insulin omission, infection, MI, drugs (SGLT2i)", "<b>HHS:</b> Type 2 DM, infection, dehydration, medications (steroids)", "<b>Stress hyperglycemia:</b> Sepsis, MI, surgery, steroids"],
                management: ["DKA: IV fluids (NS then 0.45% when Na normalizes), insulin drip 0.1 U/kg/hr, potassium repletion, identify precipitant", "HHS: Aggressive fluid resuscitation (may need 6-10L), insulin after initial fluids, watch for cerebral edema", "Goal: Decrease glucose 50-75 mg/dL per hour", "Close anion gap before stopping insulin drip", "Transition to subQ insulin when eating and gap closed"]
            },
            { id: 47, name: "Hypoglycemia", subtitle: "Low Blood Sugar", category: "endocrine", direction: "low", severity: "critical",
                thresholds: { normal: "70-100 mg/dL", mild: "54-70", moderate: "40-53", severe: "<40", critical: "<30" },
                differential: ["Insulin/sulfonylurea overdose", "Sepsis", "Liver failure", "Adrenal insufficiency", "Alcohol", "Malnutrition", "Insulinoma", "Post-gastric bypass", "Renal failure (decreased insulin clearance)"],
                management: ["Conscious: Glucose tabs, juice (15g carbs), recheck in 15 min", "Unconscious/severe: D50 25-50mL IV push, or glucagon 1mg IM", "Sulfonylurea-induced: May need prolonged dextrose infusion (long half-life)", "Octreotide 50-100 mcg SC q6-8h for sulfonylurea", "Identify and address underlying cause"]
            },
            { id: 48, name: "Elevated TSH", subtitle: "Hypothyroidism", category: "endocrine", direction: "high", severity: "moderate",
                thresholds: { normal: "0.4-4.0 mIU/L", subclinical: "4-10 + normal T4", mild: "10-20", moderate: "20-50", severe: ">50" },
                differential: ["Primary hypothyroidism (Hashimoto's, post-ablation, post-surgical, medications)", "Recovery from sick euthyroid", "TSH-secreting adenoma (rare, T4 also elevated)", "Assay interference (heterophile antibodies)"],
                management: ["Check free T4 to confirm primary hypothyroidism", "Levothyroxine: Start 1.6 mcg/kg/day in healthy adults", "Elderly/cardiac disease: Start low (25-50 mcg) and titrate slowly", "Myxedema coma: IV levothyroxine 200-400 mcg load + hydrocortisone", "Recheck TSH 6-8 weeks after dose changes"]
            },
            { id: 49, name: "Low TSH", subtitle: "Hyperthyroidism", category: "endocrine", direction: "low", severity: "moderate",
                thresholds: { normal: "0.4-4.0 mIU/L", subclinical: "0.1-0.4 + normal T4/T3", overt: "<0.1 + elevated T4/T3", suppressed: "<0.01" },
                differential: ["Graves disease (diffuse goiter, TSI+)", "Toxic multinodular goiter", "Toxic adenoma", "Thyroiditis (subacute, postpartum)", "Exogenous thyroid hormone", "Central hypothyroidism (low TSH, low T4)"],
                management: ["Check free T4, free T3, TSI/TRAb", "Beta-blocker for symptom control", "Methimazole: 10-30mg daily (first-line)", "PTU: Reserved for first trimester pregnancy, thyroid storm", "Thyroid storm: PTU + beta-blocker + iodine (1hr after PTU) + steroids", "Definitive treatment: Radioactive iodine or surgery"]
            },
            { id: 50, name: "Low Cortisol", subtitle: "Adrenal Insufficiency", category: "endocrine", direction: "low", severity: "critical",
                thresholds: { amNormal: ">10 Î¼g/dL (8am)", insufficient: "<3", indeterminate: "3-10", adequate: ">18 (post-stim)" },
                differential: ["<b>Primary (Addison):</b> Autoimmune, infection (TB, fungal), hemorrhage (Waterhouse-Friderichsen), metastases", "<b>Secondary:</b> Chronic steroids (most common), pituitary disease, hypothalamic disease", "<b>Tertiary:</b> Abrupt steroid withdrawal"],
                management: ["Morning cortisol <3: Highly suggestive of AI", "ACTH stimulation test: Cortisol should rise to >18 Î¼g/dL", "Adrenal crisis: Stress-dose steroids immediately (hydrocortisone 100mg IV q8h)", "Don't delay steroids waiting for test results if high suspicion", "Chronic: Hydrocortisone 15-25mg daily divided doses + fludrocortisone (if primary)"]
            },
            { id: 51, name: "Elevated Cortisol", subtitle: "Cushing Syndrome", category: "endocrine", direction: "high", severity: "moderate",
                thresholds: { amNormal: "5-25 Î¼g/dL", elevated: ">25", lateNight: ">7.5 (salivary)", ufc: ">4Ã— ULN" },
                differential: ["Exogenous steroids (most common)", "ACTH-secreting pituitary adenoma (Cushing disease)", "Ectopic ACTH (small cell lung cancer)", "Adrenal adenoma/carcinoma", "Pseudo-Cushing (alcohol, depression, obesity)"],
                management: ["Screen: 24h urine free cortisol, late-night salivary cortisol, 1mg overnight dexamethasone suppression test", "If positive: Check ACTH (high = ACTH-dependent, low = adrenal)", "Imaging: MRI pituitary, CT chest/adrenals", "Treatment depends on source: Surgery, radiation, medical (ketoconazole, metyrapone)"]
            },
            { id: 52, name: "Elevated PTH", subtitle: "Hyperparathyroidism", category: "endocrine", direction: "high", severity: "moderate",
                thresholds: { normal: "15-65 pg/mL", elevated: ">65", secondary: "High PTH + low/normal Ca", tertiary: "High PTH + high Ca + CKD" },
                differential: ["<b>Primary:</b> Parathyroid adenoma (85%), hyperplasia (15%), carcinoma (<1%)", "<b>Secondary:</b> CKD (phosphate retention, low vitamin D), vitamin D deficiency", "<b>Tertiary:</b> Autonomous PTH after prolonged secondary"],
                management: ["Primary: Surgery (parathyroidectomy) if symptomatic or meets criteria", "Criteria: Ca >1 above normal, osteoporosis, CrCl <60, age <50, stones", "Medical: Cinacalcet if not surgical candidate", "Secondary: Treat vitamin D deficiency, phosphate binders in CKD", "Monitor calcium, phosphorus, vitamin D levels"]
            },
            { id: 53, name: "Low PTH", subtitle: "Hypoparathyroidism", category: "endocrine", direction: "low", severity: "moderate",
                thresholds: { normal: "15-65 pg/mL", low: "<15 with low calcium", suppressed: "Appropriate if hypercalcemic" },
                differential: ["Post-surgical (thyroidectomy, parathyroidectomy)", "Autoimmune", "Magnesium depletion (impairs PTH secretion and action)", "Infiltrative (hemochromatosis, Wilson)", "Radiation", "DiGeorge syndrome"],
                management: ["Confirm low calcium with low/inappropriately normal PTH", "Acute hypocalcemia: IV calcium gluconate", "Check and replete magnesium (required for PTH function)", "Chronic: Calcium supplements + active vitamin D (calcitriol)", "Goal: Low-normal calcium to avoid hypercalciuria/stones"]
            },
            { id: 54, name: "Elevated HbA1c", subtitle: "Glycemic Control", category: "endocrine", direction: "high", severity: "moderate",
                thresholds: { normal: "<5.7%", prediabetes: "5.7-6.4%", diabetes: "â‰¥6.5%", poorControl: ">9%", veryPoor: ">12%" },
                differential: ["Diabetes mellitus (type 1, type 2, other)", "Prediabetes", "Falsely elevated: Iron deficiency, asplenia, certain hemoglobin variants", "Falsely low: Hemolysis, recent transfusion, hemoglobin variants, CKD with EPO"],
                management: ["A1c reflects ~3 month average glucose", "A1c 7% â‰ˆ average glucose 154 mg/dL", "Target <7% for most adults with diabetes", "Target <8% for elderly, limited life expectancy, high hypoglycemia risk", "Adjust medications if not at goal, check adherence and lifestyle"]
            },
            { id: 55, name: "Low Vitamin D", subtitle: "25-OH Vitamin D", category: "endocrine", direction: "low", severity: "moderate",
                thresholds: { normal: "30-100 ng/mL", insufficient: "20-29", deficient: "12-19", severe: "<12" },
                differential: ["Inadequate sun exposure", "Dietary deficiency", "Malabsorption (celiac, IBD, gastric bypass)", "Liver disease", "CKD (can't convert to active form)", "Medications (phenytoin, phenobarbital)", "Obesity (sequestration)"],
                management: ["Deficiency: Vitamin D2 or D3 50,000 IU weekly Ã— 8-12 weeks, then maintenance", "Maintenance: 1000-2000 IU daily", "CKD stage 4-5: Use calcitriol (active form)", "Recheck level after 3 months", "Correct calcium and phosphorus abnormalities"]
            },

            // COAGULATION (56-62)
            { id: 56, name: "Elevated PT/INR", subtitle: "Extrinsic Pathway", category: "coagulation", direction: "high", severity: "severe",
                thresholds: { normal: "INR 0.9-1.1", therapeutic: "2-3 (afib/DVT)", highTherapeutic: "2.5-3.5 (mechanical valve)", supratherapeutic: ">3.5", critical: ">5" },
                differential: ["Warfarin therapy", "Vitamin K deficiency", "Liver disease", "DIC", "Factor VII deficiency", "Direct factor Xa inhibitors"],
                management: ["Active bleeding + INR >2: Vitamin K 10mg IV + FFP or 4-factor PCC", "INR >10 no bleeding: Hold warfarin, vitamin K 2.5-5mg PO", "INR 4.5-10 no bleeding: Hold warfarin, consider low-dose vitamin K", "Liver disease: Vitamin K trial (minimal response if synthetic dysfunction)", "DOAC reversal: Andexanet (Xa inhibitors), idarucizumab (dabigatran)"]
            },
            { id: 57, name: "Elevated PTT", subtitle: "Intrinsic Pathway", category: "coagulation", direction: "high", severity: "moderate",
                thresholds: { normal: "25-35 seconds", therapeutic: "60-100 (heparin)", prolonged: ">35 (not on anticoag)", critical: ">120" },
                differential: ["Heparin therapy", "Factor deficiency (VIII, IX, XI, XII)", "Lupus anticoagulant (paradoxically causes clotting)", "von Willebrand disease", "DIC", "Liver disease", "Specific factor inhibitors (antibodies)"],
                management: ["Mixing study: Corrects = factor deficiency; Doesn't correct = inhibitor", "Lupus anticoagulant: Paradoxically causes clotting, not bleeding", "Hemophilia: Factor VIII or IX replacement", "Heparin-induced: Check anti-Xa level (more accurate than PTT)", "Pre-procedure: Identify cause before attempting to correct"]
            },
            { id: 58, name: "Elevated Fibrinogen", subtitle: "Acute Phase Reactant", category: "coagulation", direction: "high", severity: "moderate",
                thresholds: { normal: "200-400 mg/dL", acute: ">400", elevated: ">700" },
                differential: ["Acute inflammation/infection", "Malignancy", "Pregnancy", "Trauma/surgery", "Nephrotic syndrome", "Estrogen therapy", "Smoking"],
                management: ["Elevated fibrinogen is a cardiovascular risk factor", "Acute phase reactant - rises with inflammation", "No specific treatment for elevated fibrinogen alone", "Treat underlying condition", "Monitor other inflammatory markers (CRP, ESR)"]
            },
            { id: 59, name: "Low Fibrinogen", subtitle: "Hypofibrinogenemia", category: "coagulation", direction: "low", severity: "severe",
                thresholds: { normal: "200-400 mg/dL", low: "100-199", severe: "<100", critical: "<50" },
                differential: ["DIC (most common in hospitalized patients)", "Liver failure", "Massive transfusion/hemodilution", "Thrombolytic therapy", "Hereditary (rare)", "L-asparaginase", "Severe bleeding with consumption"],
                management: ["<100 mg/dL with bleeding: Cryoprecipitate (10 units raises ~50 mg/dL)", "Target >100-150 mg/dL for active bleeding", "DIC: Treat underlying cause, supportive transfusion", "Liver failure: May need cryoprecipitate", "Each cryo unit contains ~250mg fibrinogen"]
            },
            { id: 60, name: "DIC Panel", subtitle: "Disseminated Intravascular Coagulation", category: "coagulation", direction: "high", severity: "critical",
                thresholds: { criteria: "Score â‰¥5 = overt DIC", platelet: "<100K", ptInr: ">1.2", fibrinogen: "<100", dDimer: ">2Ã— ULN" },
                differential: ["Sepsis (most common)", "Trauma/burns", "Malignancy (solid tumor, leukemia)", "Obstetric complications (abruption, amniotic embolism, HELLP)", "Transfusion reaction", "Vascular malformations"],
                management: ["ISTH DIC score: Platelets, PT, fibrinogen, D-dimer", "Treat underlying cause - most important", "Supportive: Platelets if <20K or bleeding, FFP if bleeding + elevated INR, cryoprecipitate if fibrinogen <100", "Transfusion targets less restrictive than typical: Plt >30K, fibrinogen >100", "Heparin controversial - consider in chronic DIC with thrombosis predominant"]
            },
            { id: 61, name: "HIT Workup", subtitle: "Heparin-Induced Thrombocytopenia", category: "coagulation", direction: "low", severity: "critical",
                thresholds: { fourTScore: "Low 0-3, Intermediate 4-5, High 6-8", plateletDrop: ">50% from baseline", timing: "Day 5-10 (or <1 day if prior exposure)" },
                differential: ["HIT (antibody-mediated)", "Other drug-induced thrombocytopenia", "Sepsis", "DIC", "Thrombotic microangiopathy", "Dilutional", "Post-transfusion purpura"],
                management: ["Calculate 4T score first (thrombocytopenia, timing, thrombosis, other causes)", "4T â‰¥4: Stop ALL heparin, start argatroban or bivalirudin", "Send HIT antibody (PF4) and serotonin release assay", "Do NOT wait for test results if high clinical suspicion", "Do NOT give platelets (fuels thrombosis)", "Do NOT give warfarin until platelets recover (causes limb gangrene)"]
            },
            { id: 62, name: "Low Antithrombin III", subtitle: "AT-III Deficiency", category: "coagulation", direction: "low", severity: "moderate",
                thresholds: { normal: "80-120%", low: "<80%", severe: "<50%" },
                differential: ["<b>Acquired:</b> Liver disease (decreased synthesis), nephrotic syndrome (urinary loss), DIC (consumption), heparin therapy, acute thrombosis", "<b>Hereditary:</b> Autosomal dominant"],
                management: ["Acquired: Treat underlying cause", "Low AT-III = heparin resistance (need higher doses)", "AT-III concentrate available for severe deficiency with active thrombosis", "Hereditary: Lifelong anticoagulation if thrombotic events", "Screen family members if hereditary suspected"]
            },

            // IRON STUDIES (63-66)
            { id: 63, name: "Elevated Ferritin", subtitle: "Iron Overload/Inflammation", category: "iron", direction: "high", severity: "moderate",
                thresholds: { normal: "M 24-336, F 11-307 ng/mL", elevated: ">500", veryHigh: ">1000", criticalOverload: ">2500" },
                differential: ["<b>Inflammation (acute phase reactant):</b> Infection, autoimmune, malignancy", "<b>Iron overload:</b> Hereditary hemochromatosis, transfusion-related, chronic liver disease", "Hemolysis", "Hyperthyroidism", "Still disease (very high ferritin)"],
                management: ["Elevated ferritin alone doesn't mean iron overload - check transferrin saturation", "Hemochromatosis: Transferrin sat >45% + elevated ferritin + HFE mutation", "Treatment: Phlebotomy to ferritin <50", "Inflammation: Ferritin unreliable for iron status, treat underlying condition", "Very high (>10,000): Consider Still disease, HLH, severe liver disease"]
            },
            { id: 64, name: "Low Ferritin", subtitle: "Iron Deficiency", category: "iron", direction: "low", severity: "moderate",
                thresholds: { normal: "M 24-336, F 11-307 ng/mL", borderline: "15-30", deficient: "<15", depleted: "<12" },
                differential: ["GI blood loss (most common in men, postmenopausal women)", "Menstrual blood loss", "Malabsorption (celiac, gastric bypass, H. pylori)", "Inadequate dietary intake", "Pregnancy/lactation", "Frequent blood donation"],
                management: ["Ferritin <30 is highly specific for iron deficiency", "Evaluate for GI blood loss: Age >50 or GI symptoms = colonoscopy", "Oral iron: Ferrous sulfate 325mg TID on empty stomach with vitamin C", "IV iron: If oral intolerant, malabsorption, or need rapid repletion", "Recheck ferritin after 3 months of therapy"]
            },
            { id: 65, name: "Low Transferrin Saturation", subtitle: "TSAT", category: "iron", direction: "low", severity: "moderate",
                thresholds: { normal: "20-50%", low: "<20%", veryLow: "<10%", ironOverload: ">45%" },
                differential: ["Iron deficiency", "Anemia of chronic disease (low TSAT but normal/high ferritin)", "Chronic blood loss"],
                management: ["TSAT = (Serum iron / TIBC) Ã— 100", "TSAT <20% + low ferritin = iron deficiency", "TSAT <20% + high ferritin = anemia of chronic disease", "TSAT >45% = concern for iron overload (check HFE)", "CKD: Treat if TSAT <30% and ferritin <500"]
            },
            { id: 66, name: "Elevated TIBC", subtitle: "Total Iron Binding Capacity", category: "iron", direction: "high", severity: "moderate",
                thresholds: { normal: "250-370 Î¼g/dL", elevated: ">370", veryElevated: ">450" },
                differential: ["Iron deficiency (body trying to capture more iron)", "Pregnancy", "Oral contraceptives", "Hepatitis (early)"],
                management: ["TIBC rises when body is iron deficient", "High TIBC + low ferritin + low TSAT = classic iron deficiency", "Low TIBC + high ferritin = inflammation or iron overload", "Use in conjunction with ferritin and TSAT for complete picture"]
            },

            // LIPIDS (67-70)
            { id: 67, name: "Elevated LDL", subtitle: "LDL Cholesterol", category: "lipids", direction: "high", severity: "moderate",
                thresholds: { optimal: "<100 mg/dL", nearOptimal: "100-129", borderline: "130-159", high: "160-189", veryHigh: "â‰¥190" },
                differential: ["Primary hyperlipidemia (familial, polygenic)", "Secondary causes: Hypothyroidism, nephrotic syndrome, cholestasis, diabetes, medications (thiazides, steroids)"],
                management: ["Statin therapy based on ASCVD risk calculation", "High-intensity statin: Atorvastatin 40-80mg or rosuvastatin 20-40mg", "Goal LDL: <70 for ASCVD, <100 for high risk, <130 for moderate risk", "Add ezetimibe or PCSK9 inhibitor if not at goal", "Lifestyle: Diet, exercise, weight loss"]
            },
            { id: 68, name: "Low HDL", subtitle: "HDL Cholesterol", category: "lipids", direction: "low", severity: "moderate",
                thresholds: { normal: "M >40, F >50 mg/dL", low: "M <40, F <50", veryLow: "<30" },
                differential: ["Metabolic syndrome", "Diabetes", "Smoking", "Obesity/sedentary lifestyle", "Medications (beta-blockers, anabolic steroids)", "Hypertriglyceridemia", "Genetic factors"],
                management: ["Low HDL is cardiovascular risk factor but drugs to raise HDL haven't shown benefit", "No pharmacologic treatment specifically for low HDL", "Lifestyle modifications: Exercise, smoking cessation, weight loss, moderate alcohol", "Focus on LDL lowering and overall ASCVD risk reduction"]
            },
            { id: 69, name: "Elevated Triglycerides", subtitle: "Hypertriglyceridemia", category: "lipids", direction: "high", severity: "moderate",
                thresholds: { normal: "<150 mg/dL", borderline: "150-199", high: "200-499", veryHigh: "â‰¥500", pancreatitisRisk: "â‰¥1000" },
                differential: ["Obesity, metabolic syndrome, diabetes", "Alcohol", "Medications (estrogen, steroids, HIV meds, retinoic acid)", "Hypothyroidism", "Nephrotic syndrome", "Genetic (familial hypertriglyceridemia)"],
                management: ["<500: Lifestyle + statin for ASCVD risk", ">500: Add fibrate (fenofibrate) or omega-3 (icosapent ethyl 4g/day)", ">1000: Pancreatitis risk - strict low-fat diet (<10% calories from fat), avoid alcohol", "Very high TG: Consider apheresis if refractory", "Rule out secondary causes: TSH, fasting glucose, medications"]
            },
            { id: 70, name: "Elevated Lipoprotein(a)", subtitle: "Lp(a)", category: "lipids", direction: "high", severity: "moderate",
                thresholds: { desirable: "<30 mg/dL", borderline: "30-50", elevated: ">50", veryHigh: ">100" },
                differential: ["Primarily genetic (not affected by lifestyle)", "Elevated levels = independent ASCVD risk factor", "May increase with menopause, hypothyroidism", "May decrease with estrogen, niacin"],
                management: ["Screen once in lifetime for ASCVD risk assessment", "Elevated Lp(a) supports more aggressive LDL lowering", "No approved Lp(a)-lowering therapy yet (trials ongoing)", "PCSK9 inhibitors lower Lp(a) ~25%", "Niacin lowers Lp(a) but no outcome data"]
            },

            // INFLAMMATORY (71-73)
            { id: 71, name: "Elevated ESR", subtitle: "Erythrocyte Sedimentation Rate", category: "inflammatory", direction: "high", severity: "moderate",
                thresholds: { normal: "M <15, F <20 mm/hr", mildlyElevated: "20-40", moderatelyElevated: "40-100", markedlyElevated: ">100" },
                differential: ["<b>Any inflammation:</b> Infection, autoimmune disease, malignancy", "<b>Very high (>100):</b> Giant cell arteritis, multiple myeloma, severe infection, endocarditis", "Anemia (increases ESR)", "Pregnancy, age"],
                management: ["Non-specific marker of inflammation", "ESR >100: Consider GCA (check for temporal headache, jaw claudication, vision changes), multiple myeloma, endocarditis", "Rule of thumb: Age/2 for men, (Age+10)/2 for women = upper normal", "CRP typically more useful for monitoring acute inflammation"]
            },
            { id: 72, name: "Elevated CRP", subtitle: "C-Reactive Protein", category: "inflammatory", direction: "high", severity: "moderate",
                thresholds: { normal: "<0.5 mg/dL", mild: "0.5-1", moderate: "1-10", severe: ">10", critical: ">30" },
                differential: ["Bacterial infection (typically higher than viral)", "Autoimmune disease flare (lupus, RA)", "Malignancy", "Tissue necrosis (MI, burns, surgery)", "Chronic inflammation (obesity, diabetes)"],
                management: ["Rises within 6-8 hours of inflammation, falls rapidly with resolution", "CRP >10: Strong indicator of bacterial infection or severe inflammation", "hs-CRP: Used for cardiovascular risk stratification (<1 low, 1-3 moderate, >3 high)", "More useful than ESR for monitoring acute inflammatory conditions", "Serial CRP useful for tracking response to treatment"]
            },
            { id: 73, name: "Elevated Uric Acid", subtitle: "Hyperuricemia", category: "inflammatory", direction: "high", severity: "moderate",
                thresholds: { normal: "M 3.5-7.2, F 2.5-6.2 mg/dL", elevated: ">7", goutRisk: ">9", tls: ">10 or rapid rise" },
                differential: ["<b>Overproduction:</b> Purine-rich diet, alcohol, tumor lysis syndrome, myeloproliferative disorders, psoriasis", "<b>Underexcretion:</b> CKD, dehydration, diuretics (thiazides, loops), low-dose aspirin"],
                management: ["Acute gout: NSAIDs, colchicine, or steroids (NOT allopurinol acutely)", "Urate-lowering for recurrent gout: Allopurinol (start low, titrate), febuxostat", "Target urate <6 mg/dL for chronic gout management", "TLS prophylaxis: Allopurinol + aggressive hydration, consider rasburicase if high risk", "Asymptomatic hyperuricemia: Generally don't treat"]
            },

            // ABG (74-77)
            { id: 74, name: "Elevated PaCO2", subtitle: "Respiratory Acidosis", category: "abg", direction: "high", severity: "severe",
                thresholds: { normal: "35-45 mmHg", mild: "46-50", moderate: "51-60", severe: "61-80", critical: ">80" },
                differential: ["COPD exacerbation", "Asthma (severe/near-fatal)", "Drug overdose (opioids, benzodiazepines)", "Neuromuscular disease (GBS, myasthenia gravis, ALS)", "Obesity hypoventilation", "Sleep apnea", "Chest wall abnormalities"],
                management: ["Acute: For every 10 mmHg â†‘CO2, HCO3 rises 1 mEq/L", "Chronic: For every 10 mmHg â†‘CO2, HCO3 rises 3.5 mEq/L", "COPD: BiPAP, bronchodilators, steroids, antibiotics if indicated", "Overdose: Naloxone (opioids), flumazenil (benzos - caution)", "Severe/refractory: Intubation and mechanical ventilation"]
            },
            { id: 75, name: "Low PaCO2", subtitle: "Respiratory Alkalosis", category: "abg", direction: "low", severity: "moderate",
                thresholds: { normal: "35-45 mmHg", mild: "30-34", moderate: "25-29", severe: "<25" },
                differential: ["Anxiety/hyperventilation", "Pain", "Hypoxemia (any cause)", "PE", "Sepsis (early)", "Salicylate toxicity", "Pregnancy", "CNS disorders (stroke, infection, tumor)", "Liver failure"],
                management: ["Acute: For every 10 mmHg â†“CO2, HCO3 falls 2 mEq/L", "Chronic: For every 10 mmHg â†“CO2, HCO3 falls 5 mEq/L", "Treat underlying cause", "Anxiety: Reassurance, rebreathing into bag (rarely needed)", "Hypoxemia: Supplemental O2, treat cause", "Salicylates: Check level, consider dialysis"]
            },
            { id: 76, name: "Low PaO2", subtitle: "Hypoxemia", category: "abg", direction: "low", severity: "severe",
                thresholds: { normal: "80-100 mmHg", mild: "60-79", moderate: "50-59", severe: "40-49", critical: "<40" },
                differential: ["<b>V/Q mismatch:</b> PE, pneumonia, COPD, asthma", "<b>Shunt:</b> ARDS, pulmonary edema, consolidation, AVM", "<b>Hypoventilation:</b> Overdose, neuromuscular, obesity", "<b>Diffusion impairment:</b> ILD, emphysema", "<b>Low inspired O2:</b> High altitude"],
                management: ["Calculate A-a gradient: PAO2 - PaO2 (normal = Age/4 + 4)", "Normal A-a gradient: Hypoventilation or low FiO2", "Elevated A-a gradient: V/Q mismatch, shunt, or diffusion impairment", "Supplemental oxygen, treat underlying cause", "If refractory to oxygen (shunt): May need PEEP, prone positioning"]
            },
            { id: 77, name: "Elevated A-a Gradient", subtitle: "Alveolar-Arterial Gradient", category: "abg", direction: "high", severity: "moderate",
                thresholds: { normalYoung: "<10-15 mmHg", normalOlder: "Age/4 + 4", elevated: ">30", veryElevated: ">50" },
                differential: ["<b>V/Q mismatch:</b> PE, pneumonia, atelectasis, COPD", "<b>Shunt:</b> ARDS, severe pneumonia, pulmonary edema, intracardiac shunt", "<b>Diffusion impairment:</b> ILD, pulmonary fibrosis, emphysema"],
                management: ["A-a gradient = PAO2 - PaO2", "PAO2 = (FiO2 Ã— 713) - (PaCO2/0.8)", "Normal A-a with hypoxemia: Hypoventilation (CO2 retention)", "Elevated A-a: Intrinsic lung disease", "Shunts don't respond well to O2; V/Q mismatch responds to O2"]
            },

            // BODY FLUIDS (78-82)
            { id: 78, name: "Pleural Fluid Analysis", subtitle: "Light's Criteria", category: "bodyfluid", direction: "high", severity: "moderate",
                thresholds: { transudateSAAG: "â‰¥1.1 (if heart failure)", exudateCriteria: "Any 1 of 3 Light's" },
                differential: ["<b>Transudate:</b> Heart failure, cirrhosis, nephrotic syndrome", "<b>Exudate:</b> Pneumonia (parapneumonic), malignancy, PE, TB, rheumatoid, pancreatitis, esophageal rupture"],
                management: ["Light's Criteria (exudate if ANY): Pleural/serum protein >0.5, Pleural/serum LDH >0.6, Pleural LDH >2/3 ULN serum", "Complicated parapneumonic: pH <7.2, glucose <60, positive gram stain/culture - needs drainage", "Empyema: Pus in pleural space - chest tube + antibiotics", "If clinical transudate but Light's = exudate: Check serum-pleural albumin gradient (>1.2 = transudate)"]
            },
            { id: 79, name: "CSF Analysis", subtitle: "Cerebrospinal Fluid", category: "bodyfluid", direction: "high", severity: "critical",
                thresholds: { normalWBC: "<5 cells/Î¼L", normalProtein: "15-45 mg/dL", normalGlucose: ">60% serum or >45 mg/dL" },
                differential: ["<b>Bacterial meningitis:</b> WBC >1000 (PMN predominant), protein >100, glucose <40", "<b>Viral meningitis:</b> WBC 10-500 (lymphocyte predominant), protein 50-100, glucose normal", "<b>TB/fungal:</b> WBC 50-500 (lymphocyte), protein 50-500, glucose low", "<b>Carcinomatous:</b> Lymphocyte predominant, high protein, low glucose"],
                management: ["Don't delay antibiotics for LP if bacterial meningitis suspected", "CT before LP if: Immunocompromised, CNS disease history, papilledema, focal neuro, altered consciousness, seizure", "Traumatic tap adjustment: 1 WBC per 700 RBCs", "Low glucose is concerning for bacterial/fungal/TB meningitis"]
            },
            { id: 80, name: "Synovial Fluid Analysis", subtitle: "Joint Fluid", category: "bodyfluid", direction: "high", severity: "severe",
                thresholds: { normalWBC: "<200 cells/Î¼L", noninflammatory: "<2000", inflammatory: "2000-50000", septic: ">50000 (often >100K)" },
                differential: ["<b>Non-inflammatory (<2000):</b> Osteoarthritis, trauma", "<b>Inflammatory (2000-50K):</b> Gout, pseudogout, RA, reactive arthritis", "<b>Septic (>50K, often >100K):</b> Bacterial infection"],
                management: ["WBC >50,000 with >90% PMNs: Septic until proven otherwise", "Always send gram stain and culture", "Crystals: Monosodium urate (gout) = needle-shaped, negative birefringent; CPPD (pseudogout) = rhomboid, positive birefringent", "Septic arthritis: Urgent joint drainage + IV antibiotics (vanc + 3rd gen ceph)", "Can have gout AND septic arthritis simultaneously"]
            },
            { id: 81, name: "Peritoneal Fluid", subtitle: "Ascites/SBP", category: "bodyfluid", direction: "high", severity: "severe",
                thresholds: { saag: "â‰¥1.1 = portal HTN", sbp: "PMN â‰¥250/mmÂ³", protein: "<2.5 suggests cirrhosis" },
                differential: ["<b>SAAG â‰¥1.1:</b> Cirrhosis (most common), heart failure, Budd-Chiari", "<b>SAAG <1.1:</b> Peritoneal carcinomatosis, TB peritonitis, pancreatitis, nephrotic"],
                management: ["Diagnostic paracentesis for all new ascites or hospitalized patients", "SBP diagnosis: PMN â‰¥250/mmÂ³ (don't wait for culture)", "SBP treatment: Ceftriaxone 2g IV + albumin 1.5 g/kg day 1, 1 g/kg day 3", "Secondary peritonitis: Multiple organisms, polymicrobial, surgical abdomen - CT and surgery consult", "Prophylaxis: Norfloxacin or TMP-SMX if prior SBP or ascites protein <1.5"]
            },
            { id: 82, name: "Urinalysis", subtitle: "UA Interpretation", category: "bodyfluid", direction: "high", severity: "moderate",
                thresholds: { wbc: ">5/hpf = pyuria", rbc: ">3/hpf = hematuria", bacteria: "Any = bacteriuria", protein: "Trace-3+" },
                differential: ["<b>Pyuria + bacteriuria:</b> UTI", "<b>Pyuria without bacteria:</b> TB, interstitial nephritis, STI, kidney stones", "<b>RBC casts:</b> Glomerulonephritis", "<b>WBC casts:</b> Pyelonephritis", "<b>Muddy brown casts:</b> ATN"],
                management: ["Dipstick: Leukocyte esterase = WBCs, Nitrites = bacteria (specific but not sensitive)", "Microscopy more reliable than dipstick", "Hematuria + RBC casts = glomerular source", "Hematuria + isomorphic RBCs = lower tract source", "Sterile pyuria DDx: TB, recent antibiotics, urethritis, AIN, stones"]
            },

            // INFECTIOUS (83-87)
            { id: 83, name: "HIV Testing", subtitle: "HIV Diagnosis", category: "infectious", direction: "high", severity: "moderate",
                thresholds: { fourthGen: "Ag/Ab combo (positive if HIV)", rna: ">20 copies/mL = detectable", cd4: "<200 = AIDS" },
                differential: ["HIV-1 (most common)", "HIV-2 (West Africa)", "False positive (rare with current assays)", "Acute HIV (may have negative antibody, positive RNA)"],
                management: ["Fourth-gen test (Ag/Ab combo) preferred for screening", "If positive: Confirm with HIV-1/HIV-2 differentiation assay", "Acute HIV: RNA positive but antibody negative - test RNA if high suspicion", "If newly diagnosed: CD4 count, viral load, resistance testing, start ART", "AIDS-defining: CD4 <200 or AIDS-defining illness"]
            },
            { id: 84, name: "Hepatitis Panel", subtitle: "Viral Hepatitis Serologies", category: "infectious", direction: "high", severity: "moderate",
                thresholds: { acute: "IgM positive", chronic: "IgG positive + antigen/viral load", immune: "IgG positive only (resolved or vaccinated)" },
                differential: ["Hepatitis A (fecal-oral, IgM = acute)", "Hepatitis B (bloodborne, HBsAg = active infection)", "Hepatitis C (bloodborne, anti-HCV + RNA = active)", "Hepatitis D (requires HBV co-infection)", "Hepatitis E (fecal-oral, endemic areas)"],
                management: ["Hep B: HBsAg+ = infection, Anti-HBs+ = immunity, HBeAg = high replication", "Chronic HBV: Antivirals (entecavir, tenofovir) if high viral load or cirrhosis", "Hep C: Anti-HCV + RNA = active infection, treat with DAA (cure >95%)", "Vaccination: HAV, HBV (no HCV vaccine)", "Screen chronic HBV/HCV for HCC"]
            },
            { id: 85, name: "Blood Cultures", subtitle: "Bacteremia", category: "infectious", direction: "high", severity: "critical",
                thresholds: { timing: "Before antibiotics if possible", sets: "2-3 sets from different sites", contaminant: "Single positive CoNS, diphtheroids" },
                differential: ["<b>True positives:</b> S. aureus, Strep, Enterococcus, GNR, Candida", "<b>Common contaminants:</b> Coagulase-negative staph (single bottle), Corynebacterium, Propionibacterium, Bacillus", "Line-related bacteremia", "Endocarditis"],
                management: ["Draw 2-3 sets before antibiotics (don't delay abx if septic)", "Single CoNS usually contaminant - repeat cultures", "S. aureus bacteremia: ALWAYS warrants workup - echo, ID consult, 2-6 weeks antibiotics", "Candida: Remove central lines, ophthalmology consult, 2 weeks from first negative culture", "Persistent bacteremia: Consider endocarditis, abscess, line infection"]
            },
            { id: 86, name: "Rapid Strep/Monospot", subtitle: "Pharyngitis Workup", category: "infectious", direction: "high", severity: "moderate",
                thresholds: { centor: "3-4 points = treat empirically", rapidStrep: "Positive = GAS", monospot: "Positive = EBV" },
                differential: ["Group A Streptococcus (treat with antibiotics)", "Viral pharyngitis (most common, supportive care)", "EBV mononucleosis (positive monospot)", "Fusobacterium (Lemierre syndrome)", "Gonococcal (ask about sexual history)"],
                management: ["Centor criteria: Fever, tonsillar exudate, tender anterior cervical nodes, absence of cough", "0-1 Centor: No testing or antibiotics", "2-3 Centor: Rapid strep, treat if positive", "4 Centor: Empiric antibiotics reasonable", "GAS: Penicillin VK 500mg BID Ã— 10 days or Amoxicillin 500mg BID Ã— 10 days"]
            },
            { id: 87, name: "C. difficile Testing", subtitle: "CDI Diagnosis", category: "infectious", direction: "high", severity: "moderate",
                thresholds: { pcr: "Positive = toxin gene present", toxin: "Positive = active toxin", gdhOnly: "Colonization vs infection" },
                differential: ["C. difficile infection (toxin-producing)", "C. difficile colonization (toxin genes but no active infection)", "Other infectious diarrhea", "IBD flare", "Medication-induced diarrhea"],
                management: ["Only test unformed stool (Bristol 5-7)", "NAAT (PCR) very sensitive but can detect colonization", "Two-step testing: GDH screen â†’ toxin EIA if positive", "Don't test formed stool or test of cure", "Treat based on clinical presentation + positive test", "Avoid retesting within 7 days"]
            },

            // TUMOR MARKERS (88-92)
            { id: 88, name: "PSA", subtitle: "Prostate-Specific Antigen", category: "tumor", direction: "high", severity: "moderate",
                thresholds: { normal: "<4 ng/mL (age-adjusted)", gray: "4-10", elevated: ">10", suspicious: ">20" },
                differential: ["Prostate cancer", "BPH (benign prostatic hyperplasia)", "Prostatitis", "Recent ejaculation", "Urinary retention", "Prostate manipulation (DRE, biopsy)"],
                management: ["Screening controversial - shared decision making", "PSA 4-10: ~25% chance of cancer", "PSA >10: ~50% chance of cancer", "Free PSA ratio: Lower ratio = higher cancer suspicion", "PSA velocity/doubling time for monitoring", "Not useful for diagnosis - biopsy required"]
            },
            { id: 89, name: "CA-125", subtitle: "Ovarian Cancer Marker", category: "tumor", direction: "high", severity: "moderate",
                thresholds: { normal: "<35 U/mL", elevated: ">35", markedlyElevated: ">200" },
                differential: ["Ovarian cancer (epithelial)", "Endometriosis", "Pregnancy", "Menstruation", "PID", "Liver disease/cirrhosis", "Heart failure", "Peritoneal inflammation"],
                management: ["NOT a screening test (poor sensitivity/specificity)", "Useful for monitoring known ovarian cancer treatment response", "Postmenopausal with pelvic mass + elevated CA-125 = high suspicion for malignancy", "Many benign causes - interpret in clinical context", "Premenopausal: Less useful due to many benign causes"]
            },
            { id: 90, name: "CEA", subtitle: "Carcinoembryonic Antigen", category: "tumor", direction: "high", severity: "moderate",
                thresholds: { normal: "<3 ng/mL (nonsmoker)", smoker: "<5 ng/mL", elevated: ">10", markedlyElevated: ">20" },
                differential: ["Colorectal cancer", "Other GI cancers (pancreatic, gastric)", "Lung, breast, thyroid cancer", "Smoking", "Cirrhosis", "IBD", "Pancreatitis"],
                management: ["NOT for screening - used for monitoring treated colorectal cancer", "Baseline before colon cancer treatment", "Rising CEA after treatment: Suggests recurrence", "Elevated in many benign conditions - not diagnostic alone", "Smokers have higher baseline levels"]
            },
            { id: 91, name: "AFP", subtitle: "Alpha-Fetoprotein", category: "tumor", direction: "high", severity: "moderate",
                thresholds: { normal: "<10 ng/mL", elevated: ">20", suspicious: ">200", diagnostic: ">400" },
                differential: ["Hepatocellular carcinoma", "Germ cell tumors (testicular, ovarian)", "Pregnancy", "Chronic hepatitis/cirrhosis", "Acute hepatitis"],
                management: ["HCC surveillance: AFP + ultrasound every 6 months in cirrhosis", "AFP >400 with liver mass = diagnostic for HCC (no biopsy needed)", "Testicular cancer: AFP + beta-hCG + LDH for staging and monitoring", "Can be elevated in benign liver disease (usually <100)"]
            },
            { id: 92, name: "CA 19-9", subtitle: "Pancreatic Cancer Marker", category: "tumor", direction: "high", severity: "moderate",
                thresholds: { normal: "<37 U/mL", elevated: ">37", markedlyElevated: ">1000" },
                differential: ["Pancreatic cancer", "Cholangiocarcinoma", "Other GI malignancies", "Biliary obstruction (any cause)", "Pancreatitis", "Cirrhosis"],
                management: ["NOT for screening - poor sensitivity/specificity", "Used for monitoring pancreatic cancer treatment", "Elevated in biliary obstruction (may normalize after stenting)", "Very high levels (>1000) with pancreatic mass = poor prognosis", "~10% of population doesn't express CA 19-9 (Lewis antigen negative)"]
            },

            // DRUG LEVELS (93-97)
            { id: 93, name: "Digoxin Level", subtitle: "Cardiac Glycoside", category: "drugs", direction: "high", severity: "severe",
                thresholds: { therapeutic: "0.5-2.0 ng/mL (HF: 0.5-1.0)", toxic: ">2.0", severeToxicity: ">3.0" },
                differential: ["Digoxin toxicity", "Drug interactions (amiodarone, verapamil increase levels)", "Renal insufficiency (decreased clearance)", "Hypokalemia/hypomagnesemia (increases toxicity risk)"],
                management: ["Toxicity signs: Nausea, visual changes (yellow halos), arrhythmias", "Draw level 6-8 hours after dose (steady state)", "Toxicity treatment: Stop digoxin, correct K/Mg, atropine for bradycardia", "Life-threatening toxicity: Digoxin-specific antibody fragments (DigiFab)", "Dose reduce in renal impairment"]
            },
            { id: 94, name: "Vancomycin Level", subtitle: "AUC/Trough Monitoring", category: "drugs", direction: "high", severity: "moderate",
                thresholds: { troughSerious: "15-20 mcg/mL (traditional)", aucTarget: "AUC/MIC 400-600", toxic: "Trough >20", nephrotox: "AUC >600" },
                differential: ["Subtherapeutic dosing", "Renal dysfunction (accumulation)", "Obesity (Vd changes)", "Critical illness (altered pharmacokinetics)"],
                management: ["AUC-based monitoring preferred over trough", "Trough still used: Draw 30 min before 4th dose", "Nephrotoxicity risk increases with trough >20 or concurrent nephrotoxins", "Loading dose: 25-30 mg/kg", "Maintenance based on CrCl and weight", "Red man syndrome: Slow infusion rate (not allergy)"]
            },
            { id: 95, name: "Aminoglycoside Levels", subtitle: "Gentamicin/Tobramycin", category: "drugs", direction: "high", severity: "severe",
                thresholds: { peakTraditional: "5-10 mcg/mL", troughTraditional: "<2 mcg/mL", extendedTrough: "<1 mcg/mL at 6-14h" },
                differential: ["Nephrotoxicity (trough-related)", "Ototoxicity (cumulative dose)", "Renal impairment (decreased clearance)", "Altered Vd (burns, pregnancy, ascites)"],
                management: ["Extended-interval (once daily) preferred for most infections", "Traditional dosing: Peak 5-10, trough <2", "Extended interval: Draw random level at 6-14 hours, use nomogram", "Monitor renal function (Cr every 2-3 days)", "Limit duration to minimize toxicity", "Avoid concurrent nephrotoxins"]
            },
            { id: 96, name: "Phenytoin Level", subtitle: "Antiepileptic", category: "drugs", direction: "high", severity: "severe",
                thresholds: { therapeutic: "10-20 mcg/mL", lowAlbumin: "Correct for albumin", toxic: ">20", severeToxic: ">30" },
                differential: ["Subtherapeutic (breakthrough seizures)", "Toxicity (nystagmus, ataxia, altered mental status)", "Drug interactions (many CYP interactions)", "Hypoalbuminemia (falsely low total level)"],
                management: ["Correct for low albumin: Adjusted = Measured / (0.2 Ã— albumin + 0.1)", "Or check free phenytoin level directly", "Zero-order kinetics: Small dose changes cause large level changes at higher levels", "Toxicity signs: Nystagmus (>20), ataxia (>30), lethargy (>40)", "IV: Use fosphenytoin (less hypotension, tissue necrosis)"]
            },
            { id: 97, name: "Lithium Level", subtitle: "Mood Stabilizer", category: "drugs", direction: "high", severity: "severe",
                thresholds: { therapeutic: "0.6-1.2 mEq/L", acute: "0.8-1.2 (acute mania)", maintenance: "0.6-1.0", toxic: ">1.5", severeToxic: ">2.5" },
                differential: ["Lithium toxicity (acute vs chronic)", "Dehydration (concentrates lithium)", "Drug interactions (NSAIDs, ACEi, thiazides increase levels)", "Renal impairment"],
                management: ["Draw trough 12 hours after dose", "Toxicity: Tremor, GI upset, confusion, seizures, arrhythmias", "Chronic toxicity more dangerous than acute (tissue saturation)", "Mild toxicity: Hold lithium, IV fluids", "Severe (>2.5 or symptomatic): Hemodialysis", "Avoid NSAIDs, maintain hydration"]
            },

            // MISCELLANEOUS (98-100)
            { id: 98, name: "Serum Osmolality", subtitle: "Calculated vs Measured", category: "misc", direction: "high", severity: "moderate",
                thresholds: { normal: "275-295 mOsm/kg", low: "<275", high: ">295", osmGap: ">10 = toxic alcohol" },
                differential: ["<b>High:</b> Hypernatremia, hyperglycemia, uremia, mannitol, toxic alcohols", "<b>Low:</b> Hyponatremia, overhydration", "<b>Osmolar gap:</b> Ethanol, methanol, ethylene glycol, isopropanol, propylene glycol"],
                management: ["Calculated Osm = 2Ã—Na + Glucose/18 + BUN/2.8", "Osmolar gap = Measured - Calculated (normal <10)", "Gap >10: Consider toxic alcohol ingestion", "Methanol/ethylene glycol: Fomepizole + dialysis if severe", "Ethanol contributes 4.6 mOsm per 100 mg/dL"]
            },
            { id: 99, name: "LDH", subtitle: "Lactate Dehydrogenase", category: "misc", direction: "high", severity: "moderate",
                thresholds: { normal: "140-280 U/L", elevated: ">280", markedlyElevated: ">1000" },
                differential: ["Hemolysis (with low haptoglobin)", "Tissue damage (MI, stroke, muscle)", "Malignancy (lymphoma, leukemia, solid tumors)", "Liver disease", "PE", "Pneumocystis pneumonia", "TTP/HUS"],
                management: ["Non-specific marker of cell turnover/damage", "Part of hemolysis workup (LDH elevated + haptoglobin low)", "Elevated in many conditions - interpret in context", "PCP prophylaxis: Often markedly elevated in PJP", "TTP/HUS: Very elevated LDH with thrombocytopenia and hemolysis"]
            },
            { id: 100, name: "Haptoglobin", subtitle: "Hemolysis Marker", category: "misc", direction: "low", severity: "moderate",
                thresholds: { normal: "30-200 mg/dL", low: "<30", absent: "<10", elevated: ">200 (acute phase)" },
                differential: ["<b>Low:</b> Intravascular hemolysis (binds free hemoglobin and is cleared)", "<b>Very low/absent:</b> Significant hemolysis, TTP, autoimmune hemolytic anemia, transfusion reaction, mechanical heart valve hemolysis", "<b>Elevated:</b> Acute inflammation (acute phase reactant)"],
                management: ["Low haptoglobin + elevated LDH + indirect bilirubin = hemolysis", "Absent haptoglobin highly specific for hemolysis", "Check Coombs test (DAT) to distinguish autoimmune vs non-immune hemolysis", "Peripheral smear for schistocytes (mechanical hemolysis)", "Can be normal in extravascular hemolysis (splenic sequestration)"]
            }
        ];

        // State
        let activeFilters = { category: 'all', direction: 'all', search: '' };

        // Render lab card with auto-linked text
        function renderLabCard(lab) {
            const thresholdHtml = Object.entries(lab.thresholds).map(([key, value]) => `
                <div class="threshold-item">
                    <div class="threshold-label">${key}</div>
                    <div class="threshold-value">${value}</div>
                </div>
            `).join('');

            const differentialHtml = lab.differential.map(d => `<div class="list-item">${autoLinkText(d)}</div>`).join('');
            const managementHtml = lab.management.map(m => `<div class="list-item">${autoLinkText(m)}</div>`).join('');

            return `
                <div class="lab-card" id="lab-${lab.id}">
                    <div class="lab-header">
                        <div>
                            <div class="lab-title">${lab.id}. ${lab.name}</div>
                            <div class="lab-subtitle">${lab.subtitle}</div>
                        </div>
                        <div class="badge-container">
                            <span class="badge badge-${lab.direction}">${lab.direction === 'high' ? 'â†‘ HIGH' : 'â†“ LOW'}</span>
                            <span class="badge badge-${lab.severity}">${lab.severity.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-title">ðŸ“Š Reference Thresholds</div>
                        <div class="threshold-grid">${thresholdHtml}</div>
                    </div>
                    <div class="section">
                        <div class="section-title">ðŸ” Differential Diagnosis</div>
                        ${differentialHtml}
                    </div>
                    <div class="section">
                        <div class="section-title">ðŸ’Š Management</div>
                        ${managementHtml}
                    </div>
                </div>
            `;
        }

        function renderLabCards() {
            const filtered = labValues.filter(lab => {
                const matchesCategory = activeFilters.category === 'all' || lab.category === activeFilters.category;
                const matchesDirection = activeFilters.direction === 'all' || lab.direction === activeFilters.direction;
                const searchLower = activeFilters.search.toLowerCase();
                const matchesSearch = !searchLower || 
                    lab.name.toLowerCase().includes(searchLower) ||
                    lab.subtitle.toLowerCase().includes(searchLower) ||
                    lab.differential.some(d => d.toLowerCase().includes(searchLower)) ||
                    lab.management.some(m => m.toLowerCase().includes(searchLower));
                return matchesCategory && matchesDirection && matchesSearch;
            });

            document.getElementById('labGrid').innerHTML = filtered.map(renderLabCard).join('');
            document.getElementById('resultsInfo').textContent = 
                filtered.length === labValues.length 
                    ? `Showing all ${labValues.length} laboratory values`
                    : `Showing ${filtered.length} of ${labValues.length} laboratory values`;
        }

        function buildTOC() {
            const categories = {};
            labValues.forEach(lab => {
                if (!categories[lab.category]) categories[lab.category] = [];
                categories[lab.category].push(lab);
            });

            const tocHtml = Object.entries(categories).map(([cat, labs]) => `
                <div class="toc-category">
                    <h4>${categoryNames[cat] || cat}</h4>
                    <ul class="toc-list">
                        ${labs.map(lab => `<li><a href="#lab-${lab.id}" class="toc-link">${lab.id}. ${lab.name}</a></li>`).join('')}
                    </ul>
                </div>
            `).join('');

            document.getElementById('tocGrid').innerHTML = tocHtml;
        }

        // Event Listeners
        document.getElementById('searchBox').addEventListener('input', (e) => {
            activeFilters.search = e.target.value;
            renderLabCards();
        });

        document.getElementById('categoryFilters').addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                document.querySelectorAll('#categoryFilters .filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                activeFilters.category = e.target.dataset.category;
                renderLabCards();
            }
        });

        document.getElementById('directionFilters').addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                document.querySelectorAll('#directionFilters .filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                activeFilters.direction = e.target.dataset.direction;
                renderLabCards();
            }
        });

        document.getElementById('tocToggle').addEventListener('click', () => {
            const content = document.getElementById('tocContent');
            const arrow = document.getElementById('tocArrow');
            content.classList.toggle('show');
            arrow.textContent = content.classList.contains('show') ? 'â–²' : 'â–¼';
            // Scroll ToC into view when expanded
            if (content.classList.contains('show')) {
                setTimeout(() => {
                    document.getElementById('tocToggle').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        });

        // Back to top button
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            backToTop.classList.toggle('show', window.scrollY > 300);
        });
        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // TOC smooth scroll - use closest() to handle clicks on child elements
        document.getElementById('tocGrid').addEventListener('click', (e) => {
            const link = e.target.closest('.toc-link');
            if (link) {
                e.preventDefault();
                const targetId = link.getAttribute('href').slice(1);
                const targetEl = document.getElementById(targetId);
                if (targetEl) {
                    // Manual scroll calculation to account for sticky header
                    const headerOffset = 70;
                    const elementPosition = targetEl.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                }
                document.getElementById('tocContent').classList.remove('show');
                document.getElementById('tocArrow').textContent = 'â–¼';
            }
        });

        // IMCRG link click handler - opens slide panel
        document.getElementById('labGrid').addEventListener('click', (e) => {
            if (e.target.classList.contains('imcrg-link')) {
                e.preventDefault();
                e.stopPropagation();
                const anchor = e.target.dataset.anchor;
                const term = e.target.dataset.term;
                openPanel(anchor, term);
            }
        });

        // Panel close and fullscreen handlers
        document.getElementById('panelClose').addEventListener('click', closePanel);
        document.getElementById('panelOverlay').addEventListener('click', closePanel);
        document.getElementById('panelFullscreen').addEventListener('click', openFullscreen);
        
        // Escape key closes panel
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closePanel();
        });

        // Initialize
        buildTOC();
        renderLabCards();
    </script>
</body>
</html>
