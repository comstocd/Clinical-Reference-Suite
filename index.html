<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clinical Reference Suite</title>
    <style>
        :root {
            --sidebar-width-expanded: 220px;
            --sidebar-width-collapsed: 60px;
            --header-height: 50px;
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --text-color: #ecf0f1;
            --hover-color: #4a6785;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #1a1a2e; 
            overflow: hidden; 
            height: 100vh;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .header-logo {
            width: 36px;
            height: 36px;
            margin-right: 12px;
        }
        .header-title {
            color: var(--text-color);
            font-size: 18px;
            font-weight: 600;
        }
        .header-subtitle {
            color: #bdc3c7;
            font-size: 12px;
            margin-left: 10px;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            bottom: 0;
            width: var(--sidebar-width-collapsed);
            background: linear-gradient(180deg, var(--primary-color), #1a252f);
            transition: width 0.3s ease;
            z-index: 999;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .sidebar.expanded { width: var(--sidebar-width-expanded); }
        
        .sidebar-toggle {
            width: 100%;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            -webkit-tap-highlight-color: rgba(255,255,255,0.2);
            touch-action: manipulation;
            min-height: 50px;
        }
        .sidebar.expanded .sidebar-toggle { justify-content: flex-end; padding-right: 20px; }
        .sidebar-toggle:hover { background: var(--hover-color); }
        
        .nav-items { 
            flex: 1; 
            padding: 10px 0; 
            overflow-y: auto; 
            overflow-x: hidden; 
            -webkit-overflow-scrolling: touch;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px;
            color: #bdc3c7;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            border-left: 3px solid transparent;
            text-decoration: none;
            -webkit-tap-highlight-color: rgba(52, 152, 219, 0.3);
            touch-action: manipulation;
            min-height: 54px;
            -webkit-user-select: none;
            user-select: none;
        }
        .nav-item:hover { background: var(--hover-color); color: var(--text-color); }
        .nav-item.active { background: var(--accent-color); color: white; border-left-color: #fff; }
        
        .nav-icon {
            font-size: 22px;
            min-width: 34px;
            text-align: center;
        }
        .nav-label {
            margin-left: 12px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s, visibility 0.2s;
        }
        .sidebar.expanded .nav-label { opacity: 1; visibility: visible; pointer-events: auto; }
        
        /* Main Content */
        .main-content {
            position: fixed;
            top: var(--header-height);
            left: var(--sidebar-width-collapsed);
            right: 0;
            bottom: 0;
            transition: left 0.3s ease;
            background: #16213e;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        .sidebar.expanded ~ .main-content { left: var(--sidebar-width-expanded); }
        
        .tool-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            -webkit-overflow-scrolling: touch;
            overflow: auto;
        }
        .tool-frame.active { display: block; }
        
        /* Loading indicator */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-color);
            font-size: 18px;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            margin-left: 10px;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .header-subtitle { display: none; }
            .sidebar { width: var(--sidebar-width-collapsed); }
            .sidebar.expanded { width: 200px; }
            .main-content { left: var(--sidebar-width-collapsed); }
            .sidebar.expanded ~ .main-content { left: 200px; }
        }
    </style>
</head>
<body ontouchstart="">
    <!-- Header -->
    <header class="header">
        <img src="https://raw.githubusercontent.com/comstocd/rapid-response-tool/main/caduceus.png" alt="Logo" class="header-logo">
        <span class="header-title">Clinical Reference Suite</span>
        <span class="header-subtitle">Internal Medicine Tools</span>
    </header>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">
            <span id="toggleIcon">‚ò∞</span>
        </button>
        <div class="nav-items" id="navItems">
            <!-- Nav items injected by JavaScript -->
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="loading" id="loadingIndicator" style="display:none;">Loading tool...</div>
        
        <!-- Home Content with Tiles -->
        <div id="homeContent" style="padding:30px; overflow-y:auto; height:100%; background:#f7fafc;">
            <div style="max-width:1200px; margin:0 auto;">
                <h1 style="color:#1a365d; margin:0 0 10px 0; font-size:1.8rem;">üìö Clinical Reference Suite</h1>
                <p style="color:#718096; margin:0 0 30px 0;">Evidence-based point-of-care references for hospital medicine</p>
                
                <h2 style="color:#1a365d; font-size:1.2rem; margin:0 0 15px 0; padding-bottom:10px; border-bottom:2px solid #e2e8f0;">üìñ Core Reference Guides</h2>
                <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px; margin-bottom:30px;">
                    <div onclick="switchTool('imcrg')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#1e3a5f,#2d5a87); color:#fff; padding:20px; font-weight:700;">üìö Internal Medicine Clinical Reference Guide</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">Comprehensive hospital medicine reference covering essential conditions with evidence-based diagnostic workups, treatment protocols, and clinical pearls.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">148 Conditions</span>
                        </div>
                    </div>
                    <div onclick="switchTool('id')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#004080,#0066cc); color:#fff; padding:20px; font-weight:700;">ü¶† Infectious Disease Guide</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">Antibiotic selection, empiric therapy, pathogen-specific guidance, renal dosing, IV-to-PO conversion, and antimicrobial stewardship tools.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">BUILD #3</span>
                        </div>
                    </div>
                    <div onclick="switchTool('labs')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#0d47a1,#1976d2); color:#fff; padding:20px; font-weight:700;">üî¨ Laboratory Values Reference</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">Normal ranges, critical values, and interpretation guidance for common laboratory tests including CBC, BMP, LFTs, coagulation studies, and more.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">Quick Reference</span>
                        </div>
                    </div>
                    <div onclick="switchTool('dxfx')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#00695c,#00897b); color:#fff; padding:20px; font-weight:700;">ü©∫ Diagnostic Framework</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">Systematic approaches to common clinical presentations including chest pain, dyspnea, altered mental status, and acid-base disorders.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">Clinical Reasoning</span>
                        </div>
                    </div>
                </div>
                
                <h2 style="color:#1a365d; font-size:1.2rem; margin:0 0 15px 0; padding-bottom:10px; border-bottom:2px solid #e2e8f0;">üõ†Ô∏è Practical Tools</h2>
                <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px; margin-bottom:30px;">
                    <div onclick="switchTool('drugs')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#5c4d7d,#7c6a9a); color:#fff; padding:20px; font-weight:700;">üíä Drug Interactions Reference</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">High-yield drug interactions for warfarin, DOACs, immunosuppressants, CYP450 interactions, QT prolongation risk, and serotonin syndrome.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">BUILD #1</span>
                        </div>
                    </div>
                    <div onclick="switchTool('procedures')" style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); cursor:pointer; overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#2d5a4a,#3d7a6a); color:#fff; padding:20px; font-weight:700;">üíâ Procedures Quick Reference</div>
                        <div style="padding:20px;">
                            <p style="color:#718096; margin:0 0 12px 0; font-size:0.95rem;">Bedside procedure guidance including paracentesis, thoracentesis, lumbar puncture, and arthrocentesis with fluid interpretation tables.</p>
                            <span style="background:#f0f4f8; padding:6px 12px; border-radius:6px; font-size:0.85rem; font-weight:600; color:#2c5282;">BUILD #1</span>
                        </div>
                    </div>
                </div>
                
                <div style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); padding:25px; margin-top:20px;">
                    <h3 style="color:#1a365d; margin:0 0 15px 0; font-size:1.1rem;">‚ö° Quick Access ‚Äî High-Yield Topics</h3>
                    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:10px;">
                        <div onclick="switchTool('imcrg','sepsis')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Sepsis & Septic Shock</div>
                        <div onclick="switchTool('imcrg','acs')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Acute Coronary Syndrome</div>
                        <div onclick="switchTool('imcrg','heart-failure')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Heart Failure</div>
                        <div onclick="switchTool('imcrg','aki')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Acute Kidney Injury</div>
                        <div onclick="switchTool('imcrg','dka')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">DKA / HHS</div>
                        <div onclick="switchTool('imcrg','ugib')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">GI Bleeding</div>
                        <div onclick="switchTool('imcrg','pe')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Pulmonary Embolism</div>
                        <div onclick="switchTool('imcrg','stroke')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Stroke</div>
                        <div onclick="switchTool('id','empiric-therapy')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Empiric Antibiotics</div>
                        <div onclick="switchTool('id','renal-dosing')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Renal Dosing</div>
                        <div onclick="switchTool('procedures','lumbar-puncture')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">LP Interpretation</div>
                        <div onclick="switchTool('drugs','warfarin')" style="padding:12px 15px; background:#f7fafc; border-radius:8px; cursor:pointer; color:#2c5282; font-weight:500;">Warfarin Interactions</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Iframes injected by JavaScript -->
    </main>

    <script>
        // ============================================
        // TOOL CONFIGURATION - Add new tools here
        // ============================================
        const tools = [
            {
                id: "imcrg",
                name: "IM Clinical Reference",
                icon: "üìö",
                file: "im_guide.html",
                description: "148 Internal Medicine Conditions"
            },
            {
                id: "labs",
                name: "Laboratory Values",
                icon: "üî¨",
                file: "lab_values.html",
                description: "100 Laboratory Tests Reference"
            },
            {
                id: "dxfx",
                name: "Diagnostic Framework",
                icon: "ü©∫",
                file: "dx_framework.html",
                description: "Presentation-Based Diagnostic Framework"
            },
            {
                id: "id",
                name: "Infectious Disease",
                icon: "ü¶†",
                file: "id_guide.html",
                description: "Antibiotic & Infection Guide"
            },
            {
                id: "drugs",
                name: "Drug Interactions",
                icon: "üíä",
                file: "drug_interactions.html",
                description: "High-Yield Drug Interactions"
            },
            {
                id: "procedures",
                name: "Procedures",
                icon: "üíâ",
                file: "procedures_guide.html",
                description: "Bedside Procedures Quick Reference"
            }
            // To add a new tool:
            // { id: "newid", name: "Tool Name", icon: "üÜï", file: "filename.html", description: "Description" }
        ];

        // Cross-reference mapping: Lab Values ‚Üí IMCRG conditions
        const labToImcrg = {
            "hyponatremia": "hyponatremia",
            "hypernatremia": "hyponatremia", // same section
            "hypokalemia": "hyperkalemia",
            "hyperkalemia": "hyperkalemia",
            "hypocalcemia": "hypocalcemia",
            "hypercalcemia": "hypercalcemia",
            "hypomagnesemia": "hypomag",
            "dka": "dka",
            "hhs": "hhs",
            "aki": "aki",
            "ckd": "ckd-complications",
            "troponin": "acs",
            "bnp": "heart-failure",
            "lactate": "sepsis",
            "ammonia": "he",
            "inr-liver": "cirrhosis",
            "lipase": "pancreatitis",
            "csf": "meningitis",
            "pleural": "pleural-effusion",
            "ascites": "sbp",
            "rhabdo": "rhabdo",
            "dic": "dic",
            "tsh-high": "hypothyroid",
            "tsh-low": "hyperthyroid",
            "cortisol": "adrenal",
            "pf-ratio": "ards",
            "ards": "ards",
            "pulmonary-edema": "pulmonary-edema",
            "flash-edema": "pulmonary-edema",
            "hepatitis": "viral-hepatitis",
            "hav": "viral-hepatitis",
            "hbv": "viral-hepatitis",
            "hcv": "viral-hepatitis",
            "shock-liver": "ischemic-hepatitis",
            "ischemic-hepatitis": "ischemic-hepatitis",
            "ldh-liver": "ischemic-hepatitis"
        };

        // State
        let currentTool = null;
        let sidebarExpanded = false;

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const toggleIcon = document.getElementById('toggleIcon');
        const navItems = document.getElementById('navItems');
        const mainContent = document.getElementById('mainContent');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Initialize navigation
        function initNav() {
            // Add Home first, then tools
            let navHtml = `
                <div class="nav-item active" 
                     data-tool="home" 
                     title="Clinical Reference Suite Home">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-label">Home</span>
                </div>
            `;
            navHtml += tools.map(tool => `
                <div class="nav-item" 
                     data-tool="${tool.id}" 
                     title="${tool.description}">
                    <span class="nav-icon">${tool.icon}</span>
                    <span class="nav-label">${tool.name}</span>
                </div>
            `).join('');
            navItems.innerHTML = navHtml;

            // Add click handlers
            document.querySelectorAll('.nav-item').forEach(item => {
                // Use touchend for iPad (more responsive than click)
                item.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const toolId = e.currentTarget.dataset.tool;
                    if (toolId) switchTool(toolId);
                }, { passive: false });
                
                // Keep click for desktop
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const toolId = e.currentTarget.dataset.tool;
                    if (toolId) switchTool(toolId);
                });
            });
        }

        // Initialize iframes
        function initFrames() {
            tools.forEach(tool => {
                const iframe = document.createElement('iframe');
                iframe.id = `frame-${tool.id}`;
                iframe.className = 'tool-frame';
                iframe.src = tool.file;
                iframe.scrolling = 'yes';
                iframe.setAttribute('scrolling', 'yes');
                iframe.onload = () => {
                    if (tool.id === currentTool) {
                        loadingIndicator.style.display = 'none';
                    }
                };
                mainContent.appendChild(iframe);
            });
        }

        // Switch tool
        function switchTool(toolId, anchor = null) {
            // Handle home separately
            if (toolId === 'home') {
                currentTool = null;
                document.getElementById('homeContent').style.display = 'block';
                document.querySelectorAll('.tool-frame').forEach(frame => {
                    frame.classList.remove('active');
                });
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.tool === 'home');
                });
                if (window.innerWidth <= 768 && sidebarExpanded) {
                    toggleSidebar();
                }
                return;
            }
            
            if (!tools.find(t => t.id === toolId)) return;
            
            currentTool = toolId;
            
            // Hide home content
            document.getElementById('homeContent').style.display = 'none';
            
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.tool === toolId);
            });
            
            // Update frames
            document.querySelectorAll('.tool-frame').forEach(frame => {
                frame.classList.toggle('active', frame.id === `frame-${toolId}`);
            });
            
            // Navigate to anchor if specified
            if (anchor) {
                const frame = document.getElementById(`frame-${toolId}`);
                if (frame && frame.contentWindow) {
                    setTimeout(() => {
                        frame.contentWindow.location.hash = anchor;
                    }, 100);
                }
            }
            
            // Collapse sidebar on mobile after selection
            if (window.innerWidth <= 768 && sidebarExpanded) {
                toggleSidebar();
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            sidebarExpanded = !sidebarExpanded;
            sidebar.classList.toggle('expanded', sidebarExpanded);
            toggleIcon.textContent = sidebarExpanded ? '‚úï' : '‚ò∞';
        }

        // Handle cross-tool navigation
        // URL format: #tool:anchor (e.g., #imcrg:dka, #labs:hypokalemia)
        function handleCrossLink(linkString) {
            const [toolId, anchor] = linkString.replace('#', '').split(':');
            if (toolId && tools.find(t => t.id === toolId)) {
                switchTool(toolId, anchor);
            }
        }

        // Listen for messages from iframes for cross-linking
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'crosslink') {
                handleCrossLink(event.data.target);
            }
        });

        // Handle URL hash on load
        function handleInitialHash() {
            const hash = window.location.hash;
            if (hash && hash.includes(':')) {
                handleCrossLink(hash);
            }
        }

        // Event listeners
        sidebarToggle.addEventListener('touchend', (e) => {
            e.preventDefault();
            toggleSidebar();
        }, { passive: false });
        sidebarToggle.addEventListener('click', toggleSidebar);

        // Keyboard shortcut: Press 'S' to toggle sidebar
        document.addEventListener('keydown', (e) => {
            if (e.key === 's' && !e.ctrlKey && !e.metaKey && e.target.tagName !== 'INPUT') {
                toggleSidebar();
            }
        });

        // Initialize
        initNav();
        initFrames();
        handleInitialHash();
    </script>
</body>
</html>
